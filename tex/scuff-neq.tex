\documentclass[letterpaper]{article}
\usepackage[square,sort,comma,numbers]{natbib}
\newcommand{\citeasnoun}[1]{Ref.~\citenum{#1}}

\input{scufftex}

\newcommand\supsstar[1]{^{\hbox{\scriptsize{#1}}*}}
\newcommand\suptstar[1]{^{\hbox{\scriptsize{#1}}*}}
\newcommand{\IF}{^{i\text{\scriptsize F}}}
\newcommand{\IFFlux}{^{i\text{\tiny FFLUX}}}
\newcommand{\IT}{^{i\text{\scriptsize T}}}
\newcommand{\ITFlux}{^{i\text{\tiny TFLUX}}}
\newcommand{\PS}{^{\text{\scriptsize P}\mc S}}
\newcommand{\IFS}{^{i\text{\scriptsize F}\mc S}}
\newcommand{\ITS}{^{i\text{\scriptsize T}\mc S}}
%\newcommand{\vbchi}{\boldsymbol{\chi}}

\graphicspath{{figures/}}

%------------------------------------------------------------
%------------------------------------------------------------
%- Special commands for this document -----------------------
%------------------------------------------------------------
%------------------------------------------------------------

%------------------------------------------------------------
%------------------------------------------------------------
%- Document header  -----------------------------------------
%------------------------------------------------------------
%------------------------------------------------------------
\title {{\sc scuff-neq} Technical Reference}
\author {Homer Reid}
\date {July 6, 2014}

%------------------------------------------------------------
%------------------------------------------------------------
%- Start of actual document
%------------------------------------------------------------
%------------------------------------------------------------

\begin{document}
\pagestyle{myheadings}
\markright{Homer Reid: {\sc scuff-neq} Technical Reference}
\maketitle

\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Theoretical background}

{\sc scuff-neq} implements the ``fluctuating-surface-current''
(FSC) approach to computational fluctuation physics. The 
FSC method was originally developed for equilibrium Casimir
computations~\cite{Reid2009, Reid2011, Reid2013B} and later
extended to non-equilibrium phenomena in 
Refs.~\citenum{Rodriguez2012C} and \citenum{Rodriguez2013B}.
Here we present a quick summary of the key equations in this
approach.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Physical quantities from surface-current bilinears}
\label{PQsFromSCBsSection}

The FSC approach begins with the observation that, in a 
classical, deterministic scattering problem involving the 
fields of known external sources impinging upon a collection
of material bodies, many quantities of physical interest 
may be expressed as bilinear (quadratic) products of the 
\textit{surface currents} induced on the body surfaces by 
the external fields. The quantities that may be expressed
in this way include both \textbf{(a)} spatially-resolved 
fluxes of energy and momentum at individual points in space,
and \textbf{(b)} total (spatially-integrated) power-transfer 
rates, forces, and torques on individual bodies.

In this subsection we derive several such surface-current 
bilinear formulas in the context of (classical, deterministic)
scattering theory. In the following subsection we explain how 
the FSC approach converts these \textit{deterministic} 
expressions---describing energy and momentum transfer
from fixed external sources---into \textit{statistically averaged} 
expressions, describing energy and momentum transfer
due to thermal and quantum-mechanical fluctuations
in material bodies in the \textit{absence} of external
excitation.

%=================================================
%=================================================
%=================================================
\subsection*{Fields from surface currents}

Recall that in the surface-integral-equation (SIE) approach to
classical electromagnetism problems, we solve for tangential
\textit{surface currents} (both electric currents $\vb K$ 
and magnetic currents $\vb N$) flowing on the surfaces of 
homogeneous material bodies. In numerical solvers, we 
approximate these as finite expansions in a discrete set
of $N\subt{B}$ basis functions; using a convenient 6-vector notation 
in which $\bmc C\equiv {\vb K \choose \vb N}$, we put
%--------------------------------------------------------------------%
$$ \bmc C(\vb x)=\sum_{\alpha=1}^{N\subt{B}} 
   c_\alpha \bmc B_\alpha(\vb x) 
$$ 
%--------------------------------------------------------------------%
where $\{\bmc B_\alpha\}$ is a set of 6-vector basis 
functions\footnote{In {\sc scuff-neq} these take the form
$\bmc B_\alpha=$ 
$\vb b_\alpha \choose 0$ 
or 
$0 \choose \vb b_\alpha$
where $\vb b_\alpha$ is a three-vector RWG basis function.
However, the FSC formalism is not specific to this choice.}
and $\{c_\alpha\}$ are scalar expansion coefficients.
(We work at a fixed frequency $\omega$ and assume all fields
and currents vary in time like $e^{-i\omega t}$.)

The electric and magnetic fields produced by these currents
are linear functions of the $\{c_\alpha\}$ coefficients.
In 6-vector notation with $\bmc F\equiv {\vb E \choose \vb H}$, we have
%--------------------------------------------------------------------%
\numeq{FFromC}
{ \bmc F(\vb x)=
   \sum_{\alpha} c_\alpha \bmc F_\alpha(\vb x)
}
%--------------------------------------------------------------------%
where $\bmc F_\alpha={\vb E_\alpha \choose \vb H_\alpha}$ 
is the six-vector of fields produced by basis function $\bmc B_\alpha$ 
populated with unit strength. These may be calculated numerically
as convolutions over basis functions,
%--------------------------------------------------------------------%
$$ \bmc F_\alpha(\vb x)
   =\int_{\sup \bmc B_\alpha} \bmc{G}(\vb x, \vb x^\prime)
    \bmc B_\alpha(\vb x^\prime) \, d\vb x^\prime
$$
%--------------------------------------------------------------------%
where $\bmc{G}$ is an appropriate $6\times 6$ dyadic Green's
function.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Energy and momentum flux from field bilinears}

The Poynting flux and Maxwell stress tensor are quadratic functions
of the field components and may be conveniently written in the form
of 6-dimensional vector-matrix-vector products. 
In particular, the power flux in the direction of a unit vector 
$\vbhat{n}$ is
%====================================================================%
\begin{align}
 \vb P(\vb x) \cdot \vbhat{n}
   &=\frac{1}{2}\text{ Re }\varepsilon_{ijk}\vbhat{n}_i E^*_j(\vb x) H_k(\vb x)
\nn
   &=\frac{1}{4}\bmc{F}^\dagger(\vb x) \, \bmc{N}\supt{P}(\vbhat{n}) \, \bmc{F}(\vb x)
\label{PVMVP}
\end{align}
%====================================================================%
with
%====================================================================%
$$
   \bmc N\supt{P}=
   \left(\begin{array}{cc}
   0       & \vb N\supt{P}   \\ [3pt]
  -\vb N\supt{P} & 0
   \end{array}\right), 
\qquad 
   \vb N\supt{P}
   =
   \left(\begin{array}{ccc}
   0          &  \hat{n}_z & -\hat{n_y} \\
  -\hat{n}_z  &  0         & +\hat{n_x} \\
   \hat{n}_y  & -\hat{n}_x & 0
   \end{array}\right).
$$
%====================================================================%
Similarly, the flux of $i$-directed linear momentum is
%--------------------------------------------------------------------%
\begin{align}
 \vb T_{i}(\vb x) \cdot \vbhat{n} 
&=\frac{1}{2}\text{ Re }
  \left[ \epsilon E^*_i(\vb x) E_j(\vb x) 
             +\mu H^*_i(\vb x) H_j(\vb x) 
       -\frac{\delta_{ij}}{2}
         \Big( \epsilon |\vb E|^2
              +\mu      |\vb H|^2
         \Big)
 \right] \hat {n}_j
\nn
&= \frac{1}{4}\bmc{F}^\dagger(\vb x) 
   \, \bmc{N}\IF \, \bmc{F}(\vb x)
\label{IFVMVP}
\end{align}
with
%--------------------------------------------------------------------%
$$
   \bmc N\IF=
   \left(\begin{array}{cc}
   \epsilon \vb N\IF & 0 \\
            0        & \mu \vb N\IF 
   \end{array}\right)
$$
%--------------------------------------------------------------------%
where the $3\times 3$ matrix $N\IF$ has entries
%--------------------------------------------------------------------%
$$ N\IF_{ab} = 
   \delta_{ai} \hat{n}_b + \delta_{bi} \hat{n}_a
  - \hat{n}_i \delta_{ab}.
$$
%====================================================================%
For example, if we are computing the $x$-force ($i=x$)
we have 
%====================================================================%
$$ \vb N^{x\text{\tiny F}}=\left(\begin{array}{ccc}
   \hat{n}_x & \hat n_y   & \hat n_z \\
   \hat{n}_y & -\hat{n}_x & 0 \\
   \hat{n}_z & 0          & -\hat{n}_x
  \end{array}\right).
$$
The flux of $i$-directed \textit{angular} momentum, useful
for computations of torque about an origin $\vb x_0$, is
%====================================================================%
\begin{align}
 \vb t_{i}(\vb x) \cdot \vbhat{n}
&=\frac{1}{2}
  \text{ Re }
  \varepsilon_{ijk}(\vb x-\vb x_0)_j T_{k\ell}(\vb x) \hat{n}_\ell
\\
&= \frac{1}{4}\bmc{F}^\dagger(\vb x) 
   \, \bmc{N}\IT \, \bmc{F}(\vb x)
\label{ITVMVP}
\end{align}
%====================================================================%
with 
%--------------------------------------------------------------------%
$$
   \bmc N\IT=
   \left(\begin{array}{cc}
   \epsilon \vb N\IT & 0 \\
            0        & \mu \vb N\IT 
   \end{array}\right)
$$
%--------------------------------------------------------------------%
where the $3\times 3$ matrix $N\IT$ has entries ($\vb D=\vb x-\vb x_0$)
%--------------------------------------------------------------------%
$$ N\IT_{ab}=
   \varepsilon_{ija}D_j \hat{n}_b
  +\varepsilon_{ijb}D_j \hat{n}_a
  -\delta_{ab} \varepsilon_{ijk} D_j \hat{n}_k.
$$

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Energy and momentum flux from surface-current bilinears}

Equations (\ref{PVMVP}), (\ref{IFVMVP}), and (\ref{ITVMVP}) express
the flux of power or momentum as bilinear products of the field
six-vectors $\bmc F$. Using (\ref{FFromC}), we can turn these into
bilinear products of the surface-current coefficient vectors
$\vb c$. For example, the power flux (\ref{PVMVP}) becomes 
%--------------------------------------------------------------------%
\begin{align}
 \vb P(\vb x) \cdot \vbhat{n}
&=\frac{1}{4}\bmc F^\dagger(\vb x) \bmc N\supt{P}(\vbhat{n}) \bmc F(\vb x)
\nn
&=\frac{1}{4}\sum_{\alpha \beta} 
  c_\alpha^* 
  \Big[ \bmc F^\dagger_\alpha(\vb x)
        \,
        \bmc N\supt{P}(\vbhat{n})
        \,
        \bmc F_\beta(\vb x)
  \Big]
  c_\beta 
\nn
&= \vb c^\dagger \vb M\supt{PFLUX}(\vb x, \vbhat{n}) \vb c 
\label{PFluxVMVP}
\end{align}
%--------------------------------------------------------------------%
where $\vb M\supt{PFLUX}(\vb x,\vbhat{n})$ is a matrix 
appropriate for $\vbhat{n}$-directed power flux in at $\vb x$.
The fluxes of $i$-directed linear and angular momentum read
similarly
%--------------------------------------------------------------------%
\begin{align}
\vb T_i(\vb x) \cdot \vbhat{n}
&= \vb c^\dagger \vb M\IFFlux(\vb x, \vbhat{n}) \vb c 
\label{IFFluxVMVP}
\\
\vb t_i(\vb x) \cdot \vbhat{n}
&= \vb c^\dagger \vb M\ITFlux(\vb x, \vbhat{n}) \vb c 
\label{ITFluxVMVP}
\end{align}
%--------------------------------------------------------------------%
The $\vb M$ matrices in (\ref{PFluxVMVP}), (\ref{IFFluxVMVP}), and 
(\ref{ITFluxVMVP}) are $N\subt{B}\times N\subt{B}$ matrices
whose entries are themselves 6-dimensional matrix-vector products:
\begin{align*}
M_{\alpha\beta}\supt{PFLUX}(\vb x, \vbhat{n}) 
 &= \frac{1}{4} 
    \bmc F^\dagger_\alpha(\vb x) 
    \bmc N\supt{P}(\vbhat{n})
    \bmc F_\beta(\vb x) 
\\
M_{\alpha\beta}\IFFlux(\vb x, \vbhat{n})
 &= \frac{1}{4} 
    \bmc F^\dagger_\alpha(\vb x) 
    \bmc N\supt{iF}(\vbhat{n})
    \bmc F_\beta(\vb x) 
\\
M_{\alpha\beta}\ITFlux(\vb x, \vbhat{n})
 &= \frac{1}{4} 
    \bmc F^\dagger_\alpha(\vb x) 
    \bmc N\supt{iT}(\vbhat{n})
    \bmc F_\beta(\vb x).
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Power, force, and torque from surface-current bilinears}

The main quantities of interest in {\sc scuff-neq} are the
power, force, or torque (PFT) on individual bodies in a geometry.
There are actually three separate ways to derive surface-current 
bilinear expressions for these quantities, which we here consider 
in turn.

\subsubsection*{Dense surface-integral PFT bilinears}

The simplest way to obtain surface-current bilinears for the
total PFT on one or more bodies is simply to integrate the 
spatially-resolved fluxes of the previous section over a closed
bounding surface $\mc S$ containing the bodies.
Indeed, noting that the $\vb x$ and $\vbhat{n}$ dependence of
the flux expressions (\ref{PFluxVMVP}), (\ref{IFFluxVMVP}),
and (\ref{ITFluxVMVP}) is entirely contained in the $\vb M$
matrices, it is easy to integrate those expressions over
$\mc S$, then pull the surface-current vectors $\vb c$
outside the integral to identify what we shall call
the \textit{dense surface-integral PFT} (DSIPFT) matrices. 

For example, the total power absorbed by material bodies
contained within a closed surface $\mc S$
is given by integrating the LHS of (\ref{PFluxVMVP})
over $\mc S$:
%====================================================================%
\begin{align}
  P_{\mc S}\sups{abs}&=\int_{\mc S} \vb P(\vb x) \cdot \vbhat{n} \, d\vb x
\intertext{with $\vbhat{n}$ taken to be the inward-pointing surface
           normal. Insert the RHS of (\ref{PFluxVMVP}) and pull 
           $\vb c^\dagger, \vb c$ outside the integral:}
             &=\vb c^\dagger \vb M\PS \vb c
\label{PTotVMVP}
\end{align}
where the elements of 
$\vb M\PS$
involve integrals over $\mc S$:
%====================================================================%
\numeq{MPSEntries}
{ M_{\alpha\beta}\PS
  = \frac{1}{4} \int_{\mc S} 
    \bmc F^\dagger_\alpha(\vb x) 
    \bmc N\supt{P}(\vbhat{n})
    \bmc F_\beta(\vb x) 
     \, d\vb x.
}
%====================================================================%
Similarly, the time-average $i$-directed force and torque on 
material bodies contained in $\mc S$ are
%====================================================================%
\begin{align}
 F_{i\mc S} &=\vb c^\dagger \vb M\IFS \vb c
\label{FTotVMVP}
\\
 \mc T_{i\mc S} &=\vb c^\dagger \vb M\ITS \vb c
\label{TTotVMVP}
\end{align}
%====================================================================%
where the entries of $\vb M\IFS$ and $\vb M\ITS$ are similar
to (\ref{MPSEntries}) with $\bmc N\supt{P} \to \bmc N\IF, \bmc N\IT.$

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection*{Sparse surface-integral PFT bilinears}

For some quantities of interest it is possible to write alternative
surface-current bilinears that compute the same quantities as 
(\ref{PTotVMVP}), (\ref{FTotVMVP}), and (\ref{TTotVMVP})
but which involve \textit{sparse} matrices instead of dense
matrices~\cite{Reid2013a}. In particular, the (classical, deterministic) 
power, force, or torque on a body may be written as a bilinear 
function of the surface currents on that body alone in the form
$$
 P = \frac{1}{4}\vb c \vb O\supt{P} \vb c, 
 \qquad
 F_i = \frac{1}{4}\vb c \vb O\IF \vb c
 \qquad
 \mc T_i = \frac{1}{4}\vb c \vb O\IT \vb c
$$
where the $\vb O$ matrices are sparse ``overlap'' matrices
with nonzero entries only for pairs of basis functions
with overlapping support.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection*{Volume-integral PFT bilinears}

\begin{align*}
P&=\text{Re }
  \int_{\mc V} \bmc F^*(\vb x) \cdot \bmc J(\vb x) \, d\vb x
\\
&=
  \int_{\mc V} \bmc F^*(\vb x) \vbchi(\vb x) \bmc F(\vb x)\, d\vb x
\\
&=\sum_{\alpha\beta} c_\alpha^*
  \underbrace{
  \Big[ \int_{\mc V} \bmc G_\alpha^*(\vb x) \vbchi(\vb x)
                     \bmc G_\beta(\vb x) d\vb x
  \Big] c_\beta
             }_{\text{sym } \vb G}
\\
&= \vb c^\dagger \Big[ {\text{sym }\vb G} \Big] \vb c
\intertext{Similarly,}
F_i&=\frac{1}{\omega} \text{Im }
  \int_{\mc V} \bmc F_i^*(\vb x) \cdot \bmc J(\vb x) \, d\vb x
\\
&= \vb c^\dagger 
   \Big[ \frac{1}{\omega}{\text{sym }\partial_i \vb G} \Big] 
   \vb c
\\
\intertext{Similarly,}
\tau_i &= \frac{1}{\omega} \text{Im }
  \int_{\mc V} \bmc F_\theta^*(\vb x) \cdot \bmc J(\vb x) \, d\vb x
\\
&= \vb c^\dagger 
   \Big[ \frac{1}{\omega}{\text{sym }\partial_\theta \vb G} \Big] 
   \vb c
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Statistical averages of surface-current bilinears}

The previous section discussed several examples of physical
quantities $Q$ which, in classical scattering problems with 
deterministic sources and deterministic induced surface 
currents, may be computed as bilinear functions of the surface 
currents, $ Q(\vb c)=\vb c^\dagger \vb Q \vb c$. 
The heart of the FSC 
approach to nonequilibrium phenomena is a concise formula for 
the \textit{statistical average} of such surface-current bilinears,
where the averaging is performed over thermal and quantum-mechanical
fluctuations of sources inside material bodies at fixed temperatures.
A precise statement of the FSC equivalence is as follows.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{itemize}

\item
If $Q$ is a physical quantity which (in a classical, deterministic 
setting) is expressed as a bilinear function of the surface currents 
involving a matrix $\vb Q$, i.e.
%====================================================================%
\begin{subequations}
\begin{equation}
 \text{if} \qquad Q(\vb c)=\vb c^\dagger \vb Q \vb c
\end{equation}
%====================================================================%

\item
then the statistical \textit{average} of the quantity $Q$---where
the averaging is over quantum and thermal fluctuations---is given by
a sum over the contributions of sources in \textit{all} bodies:
%--------------------------------------------------------------------%
\begin{equation}
 \text{then} \qquad \big\langle Q\big\rangle
  = \sum_b \int_0^\infty \, \Theta_b(\omega) \Phi_b(\omega)\,d\omega 
\end{equation}
where 
$\Theta_b(\omega) = \frac{\hbar\omega}{e^{\hbar \omega/kT_b} - 1}$
is the Bose-Einstein factor for the temperature $T_b$ of 
body $b$, and where the ``generalized flux'' $\Phi_b$
is the trace of a four-matrix product involving the $\vb Q$ matrix:
%====================================================================%
\begin{equation}
\Phi_b
  = \frac{2}{\pi} 
    \Tr\left\{ \vb Q \vb W \overline{\vb G}_b \vb W^\dagger\right\}.
\end{equation}
%====================================================================%
\label{FSCEquivalence}
\end{subequations}
%--------------------------------------------------------------------%
Here $\vb W$ is the inverse of the BEM matrix for the 
\textit{entire} collection of bodies and $\overline{\vb G}_b$ 
is a symmetrized version of a portion of the BEM matrix for body 
$b$ alone.

\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection*{Spatially-resolved contributions to generalized fluxes}

The diagonal of the four-matrix product in (\ref{FSCEquivalence}c) 
is a vector of length $N\supt{B}$ whose entries describe the 
contributions of individual basis functions to the generalized
fluxes. If, as is true in {\sc scuff-neq}, we work in a basis
of \textit{localized} functions, we can use this observation 
to obtain spatially-resolved information on the various 
contributions to the generalized fluxes.

More specifically, since each triangular panel $\mc P$ 
in a discretized {\sc scuff-neq} geometry receives contributions 
from 6 basis functions (one electric-current and one magnetic-current
function for each of the three edges) we can roughly define the
contribution of panel $\mc P$ to the generalized flux $\phi_b$ 
as a sum of 6 diagonal elements of the matrix in curly braces
in (\ref{FSCEquivalence}c):
%====================================================================%
$$ \phi_{b}^{\mc P} 
   = 
   \sum_{n=1}^6
   \Big[\vb Q \vb W \overline{\vb G}_b \vb W^\dagger\Big]_{\alpha_n \alpha_n}
$$
%====================================================================%
where $\{\alpha_n\}, n=1\cdots 6,$ are the indices of the
aforementioned 6 basis functions associated with $\mc P.$

%====================================================================%
%====================================================================%
%====================================================================%
\appendix

\section{Computation of DSIPFT PFT matrices}

In Section \ref{PQsFromSCBsSection} we sketched expressions for
the ``dense surface-integral PFT'' (DSIPFT)
matrices $\{\vb M\PS, \vb M\IFS, \vb M\ITS\}$ which, when sandwiched
between surface-current vectors $\vb c$, yield the total
\{power, force, torque\} on objects contained within a bounding
surface $\mc S$. In this appendix we discuss the computation of 
these matrices.

\subsection{Numerical cubature}

To estimate the elements of e.g. the matrix $\vb M\PS$, we
use a cubature rule:
%====================================================================%
\begin{align}
  M_{\alpha\beta}\PS
 &= \frac{1}{4} \int_{\mc S} 
    \bmc F^\dagger_\alpha(\vb x) 
    \,
    \bmc N\supt{P}(\vbhat{n})
    \,
    \bmc F_\beta(\vb x) 
     \, d\vb x
\nn
 &\approx \frac{1}{4} \sum_{n=1}^{N\subt{C}} w_n 
    \bmc F^\dagger_\alpha(\vb x_n) 
    \,
    \bmc N\supt{P}(\vbhat{n}_n)
    \,
    \bmc F_\beta(\vb x_n) 
\label{MPSCubature}
\end{align}
%====================================================================%
where $\{w_n, \vb x_n\}$ is an $N\subt{C}$-point cubature rule 
for the surface $\mc S$ and $\vbhat{n}_n$ is the outward-pointing
surface normal to $\mc S$ at $\vb x_n.$
 
\subsection{Precomputation of field six-vectors}

%====================================================================%
%====================================================================%
%====================================================================%
\section{Computation of VIPFT PFT matrices}

%====================================================================%
\begin{align*}
 \Big[\partial_i \vb G\Big]\supt{PQ}_{\alpha \beta}
&= \int\, d\vb x \, b_{\alpha j}(\vb x)
                    \partial_i \mc F\supt{PQ}_{\beta j}(\vb x)
\end{align*}
%====================================================================%
where $\mc{F}\supt{PQ}_{\beta j}$ is the $j$th cartesian component
of the $P$-type field due to a $Q$-type current distribution
described by basis function $\vb b_\alpha$ populated with
unit strength (here \{P,Q\}$\in$\{electric, magnetic\}):
%====================================================================%
\numeq{FPQBeta}
{ \mc {F}\supt{PQ}_{\beta i}(\vb r)
  \equiv 
  \int \Gamma\supt{PQ}_{ij}(\vb r-\vb r^\prime) b_{\beta j}(\vb r^\prime)
  d\vb r^\prime
}
%====================================================================%
The kernels here are 
%====================================================================%
\begin{align*}
 \Gamma\supt{EE}_{ij}(\vb r)
&= \frac{Z_0 Z^r}{4\pi ik r^3}
   \left[ f_1(ikr)\delta_{ij} + f_2(ikr)\frac{r_i r_j}{r^2}\right] e^{ikr}
\\
 \Gamma\supt{EM}_{ij}(\vb r)
&= \frac{1}{4\pi r^3} \varepsilon_{ijk} r_k f_3(ikr) e^{ikr}
\\
 \Gamma\supt{ME}_{ij}(\vb r)
&= -\Gamma\supt{EM}_{ij}(\vb r)
\\
 \Gamma\supt{MM}_{ij}(\vb r)
&= \frac{1}{(Z_0 Z_r)^2} \Gamma\supt{EE}_{ij}(\vb r)
\end{align*}
with 
\begin{align*}
 f_1(ikr) &= 1 -ikr + (ikr)^2 \\
 f_2(ikr) &= -3 + 3ikr - (ikr)^2 \\
 f_3(ikr) &= -1 + ikr.
\end{align*}
%====================================================================%
For an RWG function, the integral (\ref{FPQBeta}) receives contributions
from two panels:
%====================================================================%
\begin{align}
  \mc {F}\supt{PQ}_{\beta i}(\vb r)
&=  \mc {F}\supt{PQ}_{\mc P_\beta^+ i}(\vb r)
   -\mc {F}\supt{PQ}_{\mc P_\beta^- i}(\vb r)
\nonumber
\intertext{where}
\mc {F}\supt{PQ}_{\mc P i}(\vb r)
&\equiv \int_{\mc P} 
   \Gamma\supt{PQ}_{ij}(\vb r-\vb r^\prime) b_{\beta j}(\vb r^\prime)\,d\vb r^\prime
\label{FPQP}
\end{align}
%====================================================================%

\subsection*{Computation in the coordinate system of $\mc P$}

To compute the integral over the single triangle $\mc P$ in (\ref{FPQP})
is easiest to work in a coordinate system in which $\mc P$
lives in the $xy$ plane with the $\vb Q$ vertex at the origin and 
one edge aligned with the $\vbhat{x}$ axis
%, as shown in Figure \ref{bBetaCoordinateSystemFigure}
.
%\begin{itemize}
% \item
% First consider $\mc F\sups{EE}(\vbrho, z)$ in the limit $z\to 0$.
% In this case the $z$-component of the field is just the usual normal 
% electric field above a sheet of surface charge density $\sigma(\vbrho)$,
% which has opposite signs on the two sides of the sheet, i.e.
%% \begin{align*}
%%   \lim_{z\to 0^\pm} \mc F_z\sups{EE}(\vbrho, z) 
%%     = \pm\frac{\sigma
%% \end{align*}
%\end{itemize}

In this case the RWG basis function is simply 
$\vb b(\vbrho)=\frac{\ell}{2A}\vbrho$
(where $\ell$ is the edge length and $A$ is the panel area) and we find
%====================================================================%
\begin{align*}
 \mc F\supt{EE}_{\mc P x}(\vbrho, z)
&=\frac{Z_0 Z^r \ell }{4\pi ik } \int_0^1 \, du \int_0^u \, dv \,
  \Big[ x^\prime f_1(ikr) +
        (x-x^\prime) 
        f_2(ikr) 
        \frac{ (\vbrho-\vbrho^\prime)\cdot \vbrho^\prime }
             { r^2 }
  \Big] \frac{e^{ikr}}{r^3}
\end{align*}
where 
$$ \vbrho^\prime(u,v)=\Big(x^\prime(u,v), y^\prime(u,v)\Big) 
   = u\vb A + v\vb B,
   \qquad r^2=|\vbrho-\vbrho^\prime|^2 + z^2.
$$
%====================================================================%
\subsection*{Computation by generalized Taylor-Duffy method}

%====================================================================%
\begin{align*}
 \Big[\partial_i \vb G\Big]\supt{PQ}_{\alpha \beta}
&= \ell_\alpha \ell_\beta \sum \pm 
  \underbrace{
   \int_{\mc P_\alpha^\pm } \, d\vb x        \,
   \int_{\mc P_\beta^\pm} \, d\vb x^\prime \,
   (\vb x-\vb Q)_j (\vb x^\prime-\vb Q^\prime)_k
   \partial_i\Gamma\supt{PQ}_{jk}(\vb r)
             }_{\mc I\supt{PQ}(\mc P_\alpha, \mc P_\beta)}
\end{align*}
%====================================================================%
The derivatives of the dyadic GFs are
%====================================================================%
\begin{align*}
 \partial_i\Gamma\supt{EE}_{jk}(\vb r)
&=\frac{Z_0 Z^r}{ik}
  \bigg\{ f_2(ikr)\Big[ r_i\delta_{jk} + r_j\delta_{ik} + r_k\delta_{ij} \Big]
         +(ikr)^2 f_3(ikr) r_i \delta_{jk}
\\
&\hspace{0.75in}
         + f_4(ikr)\frac{r_i r_j r_k}{r^2}
  \bigg\} \frac{e^{ikr}}{4\pi r^5}
\intertext{[where $ f_4(x)=15-15x+6x^2 - x^3$]}
 \partial_i\Gamma\supt{EM}_{jk}(\vb r)
&=\varepsilon_{jk\ell}
  \bigg\{  f_3(ikr) \delta_{i\ell} 
          -f_2(ikr) \frac{r_i r_\ell}{r^2} 
  \bigg\} \frac{e^{ikr}}{4\pi r^3}
\end{align*}
%====================================================================%
With these expressions we may write $\mathcal{I}\supt{PQ}$ in a
form suitable for treatment by the generalized Taylor-Duffy method,
%====================================================================%
\begin{align*}
 \mathcal{I}\supt{EE}(\mc P_\alpha, \mc P_\beta)
&=\iint \Big[  P\supt{EE}_1(\vb x, \vb x^\prime) K\supt{EE}_1(r)
             + P\supt{EE}_2(\vb x, \vb x^\prime) K\supt{EE}_2(r)
             + P\supt{EE}_3(\vb x, \vb x^\prime) K\supt{EE}_3(r)
        \Big]\,d\vb x\,d\vb x^\prime
\\
 \mathcal{I}\supt{EM}(\mc P_\alpha, \mc P_\beta)
&=\iint \Big[  P\supt{EM}_1(\vb x, \vb x^\prime) K\supt{EM}_1(r)
              +P\supt{EM}_2(\vb x, \vb x^\prime) K\supt{EM}_2(r)
        \Big]\,d\vb x \, d\vb x^\prime
\end{align*}
%====================================================================%
where the $P$s and $K$s are
%====================================================================%
\begin{align*}
%--------------------------------------------------------------------%
P\supt{EE}_1 
 &= (\vb x - \vb x^\prime)_i 
    \Big[ (\vb x-\vb Q) \cdot (\vb x^\prime-\vb Q^\prime)\Big] 
\\
 &\quad + (\vb x-\vb Q)_i 
          \Big[ (\vb x - \vb x^\prime) \cdot (\vb x^\prime-\vb Q^\prime) \Big]
        + (\vb x^\prime-\vb Q^\prime)_i 
          \Big[ (\vb x - \vb x^\prime) \cdot (\vb x-\vb Q) \Big]
\\
%--------------------------------------------------------------------%
K\supt{EE}_1 
&= f_2(ikr)\frac{e^{ikr}}{4\pi r^5}
\\[5pt]
%--------------------------------------------------------------------%
P\supt{EE}_2 
&=(\vb x - \vb x^\prime)_i 
   \Big[(\vb x-\vb Q) \cdot (\vb x^\prime-\vb Q^\prime)\Big]
\\
%--------------------------------------------------------------------%
K\supt{EE}_2 
&= -k^2 f_3(ikr)\frac{e^{ikr}}{4\pi r^3}
\\[5pt]
%--------------------------------------------------------------------%
P\supt{EE}_3 
&=(\vb x - \vb x^\prime)_i 
   \Big[ (\vb x-\vb x^\prime) \cdot (\vb x-\vb Q)  \Big]
   \Big[ (\vb x-\vb x^\prime) \cdot (\vb x^\prime-\vb Q^\prime)  \Big]
\\
%--------------------------------------------------------------------%
K\supt{EE}_3 
&= f_4(ikr)\frac{e^{ikr}}{4\pi r^7}
\\[5pt]
%--------------------------------------------------------------------%
P\supt{EM}_1 
&=\Big[(\vb x-\vb Q) \times (\vb x^\prime - \vb Q^\prime)\Big]_i
\\
%--------------------------------------------------------------------%
K\supt{EM}_1 
&= f_3(ikr)\frac{e^{ikr}}{4\pi r^3}
\\[5pt]
%--------------------------------------------------------------------%
P\supt{EM}_2 
 &= -(\vb x - \vb x^\prime)_i
     \bigg\{ (\vb x - \vb x^\prime) \cdot 
     \Big[ (\vb x-\vb Q)\times (\vb x^\prime-\vb Q^\prime) \Big]\bigg\}
\\
%--------------------------------------------------------------------%
K\supt{EM}_2
&= 
f_2(ikr) \frac{e^{ikr}}{4\pi r^5}
\end{align*}
%====================================================================%
``First integrals'' of these kernels:
\begin{align*}
 \text{if  } K(r) &= (ikr)^p \frac{e^{ikr}}{4\pi r^q} 
\\
 \text{then  } \mc K_n(r) &\equiv\int_0^n w^n K(wX) \, dw
\\
 &=\frac{(ik)^p e^{ikX}}{4\pi(n+p+1-q)}\, X^{n+p-q} \,
   \texttt{ExpRel}\Big[n+p+1-q, -ikX\Big]
\end{align*}

%====================================================================%
%====================================================================%
%====================================================================%
\newpage
\bibliographystyle{ieeetr}
\bibliography{scuff-neq}

\end{document}
