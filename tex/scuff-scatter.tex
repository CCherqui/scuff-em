\documentclass[letterpaper]{article}

\input{scufftex}

\newcommand\supsstar[1]{^{\hbox{\scriptsize{#1}}*}}
\newcommand\suptstar[1]{^{\hbox{\scriptsize{#1}}*}}

\graphicspath{{figures/}}

%------------------------------------------------------------
%------------------------------------------------------------
%- Special commands for this document -----------------------
%------------------------------------------------------------
%------------------------------------------------------------

%------------------------------------------------------------
%------------------------------------------------------------
%- Document header  -----------------------------------------
%------------------------------------------------------------
%------------------------------------------------------------
\title {{\sc scuff-scatter} Implementation Notes}
\author {Homer Reid}
\date {March 18, 2012}

%------------------------------------------------------------
%------------------------------------------------------------
%- Start of actual document
%------------------------------------------------------------
%------------------------------------------------------------

\begin{document}
\pagestyle{myheadings}
\markright{Homer Reid: {\sc scuff-scatter} Implementation Notes}
\maketitle

\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Concise Formulas for Scattered and Absorbed Power}

In many scattering problems we will want to compute the total
power scattered from, and the total power absorbed by, the
object(s) in a scattering geometry.  The na\"ive way to do 
this would be to integrate the normal Poynting vector over
some fictitious bounding surface surrounding the object(s);
this integral could be evaluated by numerical quadrature,
with the values of the Poynting vector at each quadrature
point computed by the usual {\sc libscuff} methods for
calculating scattered fields. {\sc scuff-scatter} uses a 
more efficient approach, obtaining the scattered and absorbed 
power \textit{directly} from matrix-vector and vector-vector 
(dot) products involving the BEM matrices and 
vectors.\footnote{To my knowledge, these formulas were first
derived by Steven Johnson.}

Throughout this section, $\mathcal{S}$ denotes the boundary
of the exterior medium (that is, the union of the outer surfaces
of all objects contained in the exterior medium), and 
$\vbhat{n}$ denotes the normal vector at a point on 
$\mathcal{S}$; $\vbhat{n}$ is taken positive pointing
into the exterior medium (away from the object).
We work at a single frequency and suppress $\omega$ arguments.

\subsection{Absorbed Power}

The absorbed power is the integral of the inward-directed normal 
component of the total Poynting vector over the full surface
$\mathcal{S}$:

%====================================================================%
\begin{align}
 P\sups{abs} 
&= - \oint \vb P\sups{tot}(\vb x) \cdot \vbhat{n} \, dA 
\label{AbsorbedPower}
\end{align}
%====================================================================%
where the minus sign arises because by convention we define $\vbhat{n}$ 
to be the outward-directed surface normal.

At a point $\vb x$ on $\mathcal{S}$, the (outward-directed) normal 
component of the total Poynting vector is 
%====================================================================%
\begin{align}
 \vb P\sups{tot}(\vb x) \cdot \vbhat{n}(\vb x)
  &=\frac{1}{2}\text{Re} 
    \bigg\{ \vbhat{n}(\vb x) \cdot 
            \Big[\vb E\supsstar{tot}(\vb x) \times \vb H\sups{tot}(\vb x)
            \Big]
    \bigg\}
\\
%--------------------------------------------------------------------%
\intertext{Using the fact that $|\vbhat{n}|=1$, we may rewrite this 
           in the form (temporarily suppressing $\vb x$ arguments)}
  &=-\frac{1}{2}\text{Re} 
    \Bigg\{ \big(\vbhat{n}\times \vb H\supsstar{tot}\big)
            \cdot
            \big(\vbhat{n} \times \big(-\vbhat{n} \times \vb E\sups{tot}\big)
            \big)
    \Bigg\}.
\nonumber
%--------------------------------------------------------------------%
\intertext{But the quantities in parentheses here are just the electric
           and magnetic surface currents that enter into the SIE 
           formulation of scattering problems, so we find simply}
%--------------------------------------------------------------------%
\vb P\sups{tot}(\vb x) \cdot \vbhat{n}(\vb x)
  &=-\frac{1}{2}\text{Re}
     \bigg\{ \vb K^* \cdot \Big[\vbhat{n} \times \vb N \Big] \bigg\}.
\label{PTotDotN}
\end{align}
%====================================================================%
%
% some quick matlab code that verifies the above:
%  E=rand(3,1) + sqrt(-1)*rand(3,1);
%  EStar=conj(E);
%  H=rand(3,1) + sqrt(-1)*rand(3,1);
%  nHat=rand(3,1); 
%  nHat=nHat/norm(nHat);
%  K=cross(nHat,H);
%  KStar=conj(K);
%  N=-cross(nHat,E);
%  EStarxH=cross(conj(E),H);
%  P1 = 0.5*real( nHat' * EStarxH )
%  P2 = -0.5*real( KStar.' * cross(nHat, N) );
Inserting (\ref{PTotDotN}) into (\ref{AbsorbedPower}), we have
%====================================================================%
\begin{align}
 P\sups{abs}
&=\frac{1}{2}\text{Re }\oint 
  \bigg\{ \vb K^*(\vb x) \cdot 
          \Big[\vbhat{n} \times \vb N(\vb x) \Big] 
  \bigg\} d\vb x
%--------------------------------------------------------------------%
\intertext{
Insert the surface-current expansions
$\vb K(\vb x)=\sum_\alpha k_\alpha \vb f_\alpha(\vb x), \, 
 \vb N(\vb x)=-Z_0\sum_\alpha n_\alpha \vb f_\alpha(\vb x)
$:}
%--------------------------------------------------------------------%
&=-\frac{Z_0}{2}\text{Re }\sum_{\alpha\beta}  k^*_\alpha n_\beta
  \oint  \vb f_\alpha(\vb x) \cdot  
         \Big[\vbhat{n} \times \vb f_\beta(\vb x) \Big]
         d\vb x
\\
&=-\frac{Z_0}{2}\text{Re }\sum_{\alpha\beta}  k^*_\alpha n_\beta
  \oint  \vb f_\alpha(\vb x) \cdot  
         \Big[\vbhat{n} \times \vb f_\beta(\vb x) \Big]
         d\vb x
\\
&=-\frac{Z_0}{2}\text{Re }\sum_{\alpha\beta} 
    k^*_\alpha O^{(\times)}_{\alpha\beta} n_\beta
\numeq{PAbsFormula}
\end{align}
%====================================================================%
where I 
\begin{align*}
O^{(\times)}_{\alpha\beta}
 \oint \vb f_\alpha(\vb x) \cdot 
       \Big[\vbhat{n} \times \vb f_\beta(\vb x) \Big]
       d\vb x.
\end{align*}
%====================================================================%
The matrix of quantities $O^{(\times)}_{\alpha\beta}$ is sort of like 
a crossed version of an overlap matrix for the set of 
basis functions $\{\vb f_\alpha.\}$ This is an extremely 
sparse matrix, with vanishing diagonals and precisely 4 nonzero 
entries per row, and the nonzero entries may be computed in 
closed form (cf. {\sc libscuff} technical memorandum.)
Thus the operation count for evaluating (\ref{PAbsFormula}) 
is $\mathcal{O}(4N)$, as compared to $\mathcal{O}(N^2)$ for 
the equivalent matrix-vector product formulas.

%====================================================================%
where
\begin{itemize} 
  \item \texttt{KN} is the vector of surface-current coefficients 
        computed by {\sc libscuff} as the solution to the BEM scattering
        problem
  \item $\overline{\texttt{KN}}$ denotes the vector $\texttt{KN}$ with
        signs of all magnetic currents flipped 
  \item $\dagger$ denotes the adjoint operation (complex conjugation
        and column vector$\to$row vector)
  \item \texttt{RHS} is the right-hand-side vector for the scattering 
        problem as computed by {\sc libscuff}. (Note that 
        the $1/Z_0$ factor in the electric-field inner product,
        and the overall minus sign, are both present in the RHS 
        vector as computed by {\sc libscuff};
        cf. Section 6 of the {\sc libscuff} technical memo.)
\end{itemize} 
%====================================================================%
The second term in (\ref{PAbs2}) is 
%====================================================================%
\begin{align*}
&-\frac{1}{8} \text{Re } \sum_{\alpha \beta}
 \left(\begin{array}{c} 
       k_\alpha \\[5pt] -Z_0 n_\alpha
       \end{array}
 \right)^\dagger
 %--------------------------------------------------------------------%
 \left\{
 \oint \oint 
 \left(\begin{array}{cc}
       \vb f_\alpha \cdot \BG\EEe  \cdot \vb f_\beta  &
       \vb f_\alpha \cdot \BG\EMe  \cdot \vb f_\beta  \\[5pt]
       \vb f_\alpha \cdot \BG\MEe  \cdot \vb f_\beta  &
       \vb f_\alpha \cdot \BG\MMe  \cdot \vb f_\beta
       \end{array}
 \right) 
 d\vb x^\prime d\vb x
 \right\}
 %--------------------------------------------------------------------%
 \left(\begin{array}{c} 
       k_\alpha \\[5pt] -Z_0 n_\alpha
       \end{array}
 \right)
\\[10pt]
%--------------------------------------------------------------------%
&=\quad -\frac{Z_0}{8} \text{Re } \sum_{\alpha \beta}
 \left(\begin{array}{c} 
       k_\alpha \\[5pt] -n_\alpha
       \end{array}
 \right)^\dagger
 %--------------------------------------------------------------------%
 \left\{
 \oint \oint 
 \left(\begin{array}{cc}
       \vb f_\alpha \cdot (\BG\EEe/Z_0)  \cdot \vb f_\beta  &
       \vb f_\alpha \cdot (-\BG\EMe)  \cdot \vb f_\beta  \\[5pt]
       \vb f_\alpha \cdot (\BG\MEe)  \cdot \vb f_\beta  &
       \vb f_\alpha \cdot (-Z_0\BG\MMe)  \cdot \vb f_\beta
       \end{array}
 \right) 
 d\vb x^\prime d\vb x
 \right\}
 %--------------------------------------------------------------------%
 \left(\begin{array}{c} 
       k_\alpha \\[5pt] n_\alpha
       \end{array}
 \right)
\\[10pt]
%====================================================================%
\intertext{Note that the pattern of minus signs and $Z_0$ factors in 
the matrix elements here agrees with the definition of the BEM 
matrix as computed by {\sc libscuff} (again, see Section 6 of the
technical memo), whereupon we may write this as}
&\quad -\frac{Z_0}{8} 
        \cdot \overline{\texttt{KN}}^\dagger 
        \cdot \vb M^{e}
        \cdot \texttt{KN}
\end{align*}
where $\vb M^{e}$ is the portion of the BEM matrix involving only 
the Green's function of the exterior medium. 
\textbf{Note that the second \texttt{KN} factor here does \textit{not}
have the overbar operation.}

To summarize, the total absorbed power as computed by 
{\sc scuff-scatter} is 

\numeq{PAbs3}
{P\sups{abs} = +\frac{Z_0}{4}\text{Re }
   \bigg\{ \overline{\texttt{KN}}^\dagger 
           \cdot 
           \Big[ \texttt{RHS} - \frac{1}{2}\vb M^{e} \cdot \texttt{KN}\Big]
   \bigg\}.
}

\subsubsection*{Nested Surfaces}

Expression \ref{PAbs3} remains valid as-is when nested
surfaces are present. 
This is because \textbf{(1)} assuming the incident field
sources lie in the exterior medium, the vector \texttt{RHS}
has zero entries corresponding to all basis functions 
defined on interior surfaces [whereupon those basis 
functions make no contribution to the first term in 
(\ref{PAbs3})], while \textbf{(2)} all elements of the $\vb M^{e}$ 
matrix corresponding to basis functions on interior surfaces
are zero because the Green's functions for the exterior
medium (which are the only GFs that contribute to $\vb M^{e}$)
make no contribution to matrix elements corresponding to 
interior-surface basis functions. 

\subsection{Scattered Power}

The scattered power is the integral of the outward-directed normal 
component of the \textit{scattered} Poynting vector over 
$\mathcal{S}$:
%====================================================================%
\begin{align}
 P\sups{scat} 
&= + \oint \vb P\sups{scat}(\vb x) \cdot \vbhat{n} \, dA 
\label{ScatteredPower}
\end{align}
%====================================================================%
where the scattered Poynting vector is the 
Poynting vector as computed using only the scattered fields.
In analogy to equation (\ref{PTotDotN}), we write
%====================================================================%
\begin{align}
 \vb P\sups{scat}(\vb x) \cdot \vbhat{n}(\vb x)
  &=\frac{1}{2}\text{Re} 
    \bigg[ \vb E\supsstar{scat}(\vb x) \times \vb H\sups{scat}(\vb x)\bigg] 
    \cdot \vbhat{n}(\vb x)
\\
%--------------------------------------------------------------------%
  &=-\frac{1}{4}\text{Re}
     \bigg[ \vb E\supsstar{scat} \cdot \big(\vbhat{n}\times \vb H\sups{scat} \big)
           +\vb H\supsstar{scat} \cdot \big(-\vbhat{n}\times \vb E\sups{scat} \big) 
     \bigg].
\nonumber
\end{align}
\end{document}
