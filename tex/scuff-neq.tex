\documentclass[letterpaper]{article}
\usepackage[square,sort,comma,numbers]{natbib}
\newcommand{\citeasnoun}[1]{Ref.~\citenum{#1}}

\input{scufftex}

\newcommand\supsstar[1]{^{\hbox{\scriptsize{#1}}*}}
\newcommand\suptstar[1]{^{\hbox{\scriptsize{#1}}*}}
\newcommand{\IF}{^{i\text{\scriptsize F}}}
\newcommand{\IFFlux}{^{i\text{\tiny FFLUX}}}
\newcommand{\IT}{^{i\text{\scriptsize T}}}
\newcommand{\ITFlux}{^{i\text{\tiny TFLUX}}}
\newcommand{\PS}{^{\text{\scriptsize P}\mc S}}
\newcommand{\IFS}{^{i\text{\scriptsize F}\mc S}}
\newcommand{\ITS}{^{i\text{\scriptsize T}\mc S}}
\newcommand{\wh}{\widehat}
%\newcommand{\vbchi}{\boldsymbol{\chi}}

\graphicspath{{figures/}}

%------------------------------------------------------------
%------------------------------------------------------------
%- Special commands for this document -----------------------
%------------------------------------------------------------
%------------------------------------------------------------

%------------------------------------------------------------
%------------------------------------------------------------
%- Document header  -----------------------------------------
%------------------------------------------------------------
%------------------------------------------------------------
\title {{\sc scuff-neq} Technical Reference}
\author {Homer Reid}
\date {July 6, 2014}

%------------------------------------------------------------
%------------------------------------------------------------
%- Start of actual document
%------------------------------------------------------------
%------------------------------------------------------------

\begin{document}
\pagestyle{myheadings}
\markright{Homer Reid: {\sc scuff-neq} Technical Reference}
\maketitle

\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Theoretical background}

{\sc scuff-neq} implements the ``fluctuating-surface-current''
(FSC) approach to computational fluctuation physics. The 
FSC method was originally developed for equilibrium Casimir
computations~\cite{Reid2009, Reid2011, Reid2013B} and later
extended to non-equilibrium phenomena in 
Refs.~\citenum{Rodriguez2012C} and \citenum{Rodriguez2013B}.
Here we present a quick summary of the key equations in this
approach.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Physical quantities from surface-current bilinears}
\label{PQsFromSCBsSection}

The FSC approach begins with the observation that, in a 
classical, deterministic scattering problem involving the 
fields of known external sources impinging upon a collection
of material bodies, many quantities of physical interest 
may be expressed as bilinear (quadratic) products of the 
\textit{surface currents} induced on the body surfaces by 
the external fields. The quantities that may be expressed
in this way include both \textbf{(a)} spatially-resolved 
fluxes of energy and momentum at individual points in space,
and \textbf{(b)} total (spatially-integrated) power-transfer 
rates, forces, and torques on individual bodies.

More specifically, let the six-vector of surface electric
and magnetic currents (flowing on the surfaces of \textit{all}
bodies in a geometry) be
%====================================================================%
$$ \bmc C(\vb x)\equiv{\vb K(\vb x) \choose \vb N(\vb x)}
   \approx \sum_{\alpha} c_\alpha \bmc B_\alpha(\vb x)
$$
%====================================================================%
where we have discretized by approximating $\bmc C(\vb x)$ as an
expansion in a discrete set of six-vector basis
functions\footnote{In {\sc scuff-neq} these take the form
$\bmc B_\alpha=$ 
$\vb b_\alpha \choose 0$ 
or 
$0 \choose \vb b_\alpha$
where $\vb b_\alpha$ is a three-vector RWG basis function.
However, the FSC formalism is not specific to this choice.}
\{$\bmc B_\alpha(\vb x)$\}; here $\{c_\alpha\}$ are 
scalar expansion coefficients.\footnote{In {\sc scuff-em}
the basis functions are dimensionless and the expansion
coefficients have units of 
%====================================================================%
\begin{align*}
 \big[c_{2\alpha}\big]&=\frac{\text{Amperes}}{\text{meters}}
 \quad \text{(electric surface currents)}, \qquad
 \big[c_{2\alpha+1}\big]=\frac{\text{Volts}}{\text{meters}}
 \quad \text{(magnetic surface currents).}
\end{align*}}
%====================================================================%
(We work at a fixed frequency $\omega$ and assume all fields
and currents vary in time like $e^{-i\omega t}$.)

Then the time-average values of physical quantities associated 
with power, force and torque (PFT)---including both spatially-resolved
PFT fluxes at individual points in space as well as spatially-integrated
quantities representing the total PFT on compact bodies---may 
generally be expressed as vector-matrix-vector products of the 
form
%====================================================================%
\numeq{QcQc} {Q = \vb c^\dagger \vb Q \vb c}
%====================================================================%
where $Q$ is the quantity of interest and $\vb Q$ is a matrix
that depends on the quantity we are computing and the method we
use to compute it.

\paragraph{Spatially-resolved PFT fluxes} 
For example, the time-average Poynting vector and Maxwell stress 
tensor at a point $\vb x$---that is, the time-average fluxes,
in the $\vbhat{n}$ direction, of energy, of $\vbhat{u}$-directed
linear momentum, and of $\vbhat{u}$-directed angular momentum---are
given by
%====================================================================%
$$\begin{array}{*3{>{\displaystyle}l}}
\text{Energy flux: } \qquad 
&\vb P(\vb x) \cdot \vbhat{n} 
&=\frac{1}{2}\text{Re }
   \vb c^\dagger \vb Q\supt{PFLUX}(\vb x; \vbhat{n}) \vb c
\\[10pt]
\text{Linear momentum flux: } \qquad 
&\vbhat{u} \cdot \vb T(\vb x) \cdot \vbhat{n}
&=\frac{1}{2}\text{Re }
   \vb c^\dagger \vb Q\supt{FFLUX}(\vb x; \vbhat{u}, \vbhat{n}) \vb c
\\[10pt]
\text{Angular momentum flux: } \qquad 
&\vbhat{u} \cdot \Big[(\vb x-\vb x_0) \times \vb T(\vb x)\Big] \cdot \vbhat{n}
&=\frac{1}{2}\text{Re }
   \vb c^\dagger \vb Q\supt{TFLUX}(\vb x; \vb x_0, \vbhat{u}, \vbhat{n}) \vb c
\end{array}$$
%====================================================================%
where the form of the $\vb Q\supt{P,F,T}$ matrices is derived in
the Appendix. (In the last line, $\vb x_0$ is the origin about which 
we are computing the torque).

\paragraph{Spatially-integrated PFT fluxes} 
On the other hand, the \textit{total} (spatially-integrated)
power absorbed by, and the $\vbhat{u}$-directed force and torque 
exerted on, one or more compact bodies contained within a 
closed bounding surface $\mc S$ are given by 
%====================================================================%
$$\begin{array}{*3{>{\displaystyle}l}}
\text{Absorbed power:} \qquad 
& P\sups{abs}
&=\frac{1}{2}\text{Re }
   \vb c^\dagger \vb Q\supt{P}(\mc S) \vb c
\\[10pt]
\text{Force: } \qquad 
&\vbhat{u} \cdot \vb F
&=\frac{1}{2}\text{Re }
   \vb c^\dagger \vb Q\supt{F}(\mc S; \vbhat{u}) \vb c
\\[10pt]
\text{Torque: } \qquad 
&\vbhat{u} \cdot \bmc T
&=\frac{1}{2}\text{Re }
   \vb c^\dagger \vb Q\supt{T}(\mc S; \vb x_0, \vbhat{u}) \vb c
\end{array}$$
%====================================================================%

Expressions for all of the $\vb Q$ matrices are given
in Appendix \ref{QMatrixAppendix}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Statistical averages of surface-current bilinears}

Equation (\ref{QcQc}) gives the time-average value of
a PFT quantity in a classical, deterministic scattering 
problem in which the surface currents $\vb c_\alpha$ are known.
The heart of the FSC approach to nonequilibrium phenomena 
is a concise formula for the \textit{statistical average} 
of such surface-current bilinears,
where the averaging is performed over thermal and quantum-mechanical
fluctuations of sources inside material bodies at fixed temperatures.
A precise statement of the FSC equivalence is as follows.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{itemize}

\item
If $Q$ is a physical quantity which (in a classical, deterministic 
setting) is expressed as a bilinear function of the surface currents 
involving a matrix $\vb Q$, i.e.
%====================================================================%
\begin{subequations}
\begin{equation}
 \text{if} \qquad Q=\vb c^\dagger \vb Q \vb c
\end{equation}
%====================================================================%

\item
then the statistical \textit{average} of the quantity $Q$---where
the averaging is over quantum and thermal fluctuations---is given by
a sum over the contributions of sources in all bodies:
%--------------------------------------------------------------------%
\begin{equation}
 \text{then} \qquad \big\langle Q\big\rangle
  = \int_0^\infty \, \sum_s \, \Theta(T_s,\omega) \Phi_s(\omega)\,d\omega 
\end{equation}
where 
$\Theta(T_s,\omega) = \frac{\hbar\omega}{e^{\hbar \omega/kT_s} - 1}$
is the Bose-Einstein factor for the temperature $T_s$ of 
body $s$, and where the ``generalized flux'' $\Phi_s$
is the trace of a four-matrix product involving the $\vb Q$ matrix:
%====================================================================%
\begin{equation}
\Phi_s
  = \frac{2}{\pi} 
    \Tr\left\{ \vb Q 
               \underbrace{\vb W \overline{\vb G}_s \vb W^\dagger}
                         _{\vb R_s}
       \right\}.
\end{equation}
%====================================================================%
\label{FSCEquivalence}%
\end{subequations}
%--------------------------------------------------------------------%
Here $\vb W$ is the inverse of the BEM matrix for the 
\textit{entire} collection of bodies and $\overline{\vb G}_s$ 
is a symmetrized version of a portion of the BEM matrix for body 
$s$ alone.

\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The matrix $\vb R_s$ in (\ref{FSCEquivalence})---the ``Rytov''
matrix---furnishes a concise description of the fluctuating sources
inside body $s$. For a given output quantity 
$Q$, the generalized flux $\Phi_s$ is the contribution to $Q$ 
of just the fluctuating currents that lie within body $s$
(here $s$ stands for ``source''), although these contributions
are computed with proper consideration paid to the scattering
response of the other bodies in the geometry. In other words,
$\Theta(T_s,\omega)\Phi_s$ is the contribution to $Q$ 
obtained by setting body $s$ to temperature $T_s$ and setting
all other bodies to \textit{zero} temperature, so that those
bodies are present as electromagnetic scatterers but not as 
sources of radiation.
%
%More specifically, the eigenvectors of $\vb R_s$ 
%may be interpreted as ``normal modes'' of the fluctuating source 
%distribution inside body $s$; these are surface-current vectors 
%whose contributions to time-average PFT quantities add without
%mixing.
%
%\subsection*{Structure of $\vb R_s$}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%{\scriptsize
%\begin{align*}
% \vb R_s &= \vb W \overline{\vb G}_s \vb W^\dagger
%\\
%%--------------------------------------------------------------------%
%&=\left(\begin{array}{cccc}
%  \vphantom{\vb W^\dagger_11} 
%  \vb W_{11} & \vb W_{12} & \cdots & \vb W_{1N} 
%\\ 
%  \vphantom{\vb W^\dagger_11} 
%  \vb W_{21} & \vb W_{22} & \cdots & \vb W_{2N} 
%\\ 
%  \vphantom{\vb W^\dagger_11} 
%  \vdots     & \vdots     & \ddots & \vdots     
%\\
%  \vphantom{\vb W^\dagger_11} 
%  \vb W_{N1} & \vb W_{N2} & \cdots & \vb W_{NN}
%  \end{array}\right)
%%--------------------------------------------------------------------%
% \left(\begin{array}{cccc}
%  \vphantom{\vb W^\dagger_11} 
%  0          & 0          & \cdots &         0          
%  \\ 
%  \vphantom{\vb W^\dagger_11} 
%  0          & 0          & \cdots &         0          
%  \\ 
%  \vphantom{\vb W^\dagger_11} 
%  \vdots     & \vdots     & \overline{\vb G}_{s} &  \vdots     
%  \\
%  \vphantom{\vb W^\dagger_11} 
%  0          & 0          & \cdots &         0
%  \end{array}\right)
%%--------------------------------------------------------------------%
%  \left(\begin{array}{cccc}
%  \vb W_{11}^\dagger & \vb W_{21}^\dagger & \cdots & \vb W_{N1}^\dagger \\ 
%  \vb W_{12}^\dagger & \vb W_{22}^\dagger & \cdots & \vb W_{N2}^\dagger \\ 
%  \vdots     & \vdots     & \ddots & \vdots     \\
%  \vb W_{1N}^\dagger & \vb W_{2N}^\dagger & \cdots & \vb W_{NN}^\dagger
%  \end{array}\right)
%\end{align*}
%}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%$
%The $a,b$ subblock of this matrix is
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%$
%$$ \vb R_{s; ab} = \vb W_{as} \overline{\vb G}_s \vb W_{bs}^\dagger. $$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%$

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Output files}

\subsection{Output files for spatially-integrated quantities}

Let $\big\langle Q_d\big\rangle$ be the total time-average 
power, force, or torque (PFT) on body $d$. ($d$ stands for a 
``destination'' body, as distinct from a ``source'' body
whose fluctuating sources contribute to $Q_d$). From 
equation (\ref{FSCEquivalence}b), we have
%====================================================================%
\begin{equation}
 \qquad \big\langle Q_d\big\rangle
 = \int_0^\infty \, \sum_s \, \Theta_s(\omega) 
   \Phi_{s\to d}(\omega)\,d\omega
\end{equation}
%====================================================================%
where $\Theta_s$ is the Bose-Einstein factor for the temperature 
of body $s$ and $\Phi_{s \to d}(\omega)$ is the 
(frequency-resolved, spatially-integrated) flux of power or momentum
from body $s$ to body $d$.
%====================================================================%
To evaluate this integral, it is convenient to agree to measure angular
frequency in the default {\sc scuff} units, whereupon we 
introduce a dimensionless angular frequency $u$ according 
to\footnote{Note that $u$ is the numerical quantity referred to as 
\texttt{Omega} on the {\sc scuff-neq} command line and in the 
{\sc scuff-neq} source code. Some convenient
dimensionful quantities involving $\omega_0$ are:
%====================================================================%
$$
 \hbar\omega_0=0.197\text{ eV}=31.6\cdot10^{-21} \text{ Joules}, 
 \qquad 
 \hbar\omega_0^2=9.49115\,\mu\text{W} \, (\text{microWatts}).
$$}
%====================================================================%
$$ \omega=u\cdot \omega_0
   \qquad \text{where} \qquad
   \omega_0\equiv 3\cdot 10^{14}\text{ rad/sec}.
$$
Then the total time-average PFT on body $d$ may be
expressed as an integral over the dimensionless variable $u$:
%====================================================================%
\numeq{QAverage}
{
 \qquad \big\langle Q_d\big\rangle
 = \hbar \omega_0^2
   \int_0^\infty 
              \sum_s \, \wh \Theta_s (u) \Phi\supt{PFT}_{s\to d}(u)\,du
}
%====================================================================%
where $\wh \Theta_s(u)$ is a dimensionless version 
of the Bose-Einstein factor for source body $s$,
%====================================================================%
$$ \wh \Theta_s(u)\equiv \frac{u}{e^{\beta_s u}-1}, 
   \qquad 
   \beta_s \equiv \frac{\hbar \omega_0}{kT_s}
    \approx \frac{ 2278 }{T_s\text{ in Kelvin.}}
$$
%====================================================================%
The various constituents of equation (\ref{QAverage}) are written
by {\sc scuff-neq} to three distinct output files, as follows:
%====================================================================%
\numeq{QAverage2}
{
 \qquad \big\langle Q_d\big\rangle
 = \hbar \omega_0^2
   \underbrace{
   \Bigg[
   \int_0^\infty 
  \underbrace{\bigg\{ \sum_s \, \wh \Theta_s(u)
  \underbrace{\Phi\supt{PFT}_{s\to d}(u)}_{\texttt{.SIFlux}}
             \bigg\} }_{\texttt{.SIIntegrand}}
   \,\,du \Bigg]
              }_{\texttt{.NEQPFT}}
}
%====================================================================%
More specifically, 
%====================================================================%
\begin{itemize}
  \item The quantity $\Phi_{s\to d}(u)$ is written to the
        \texttt{.SIFlux} file. This quantity may be interpreted
        as the PFT per unit frequency per
        unit temperature exerted on body $d$ due to sources
        in body $s.$ This is a temperature-independent quantity.
        For \texttt{PFT}=power, this quantity
        is \textit{dimensionless}. For \texttt{PFT}=force,
        this quantity has units of \textit{nanoNewtons/watts}.
  \item The quantity written to the \texttt{.SIIntegrand} file
        is the PFT per unit frequency exerted on body $d$ due to 
        thermally-weighted sources in body $s$.
        (The \texttt{.SIIntegrand} file records, for each 
         destination body $d$, both the individual contributions
         of each source body $s$ and the total contributions
         of all source bodies.)
  \item The quantity written to the \texttt{.NEQPFT} file
        is the total time-average PFT exerted on body $d$ due to 
        thermally-weighted sources in body $s$.
        (The \texttt{.NEQPFT} file records, for each
         destination body $d$, both the individual contributions
         of each source body $s$ and the total contributions
         of all source bodies.)
\end{itemize}
%====================================================================%

\subsection{An explicit example}

To elucidate the significance of the various numerical
quantities reported in the {\sc scuff-neq} output files,
we now consider two explicit worked examples.

\subsubsection{Power radiation of a single sphere}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{{\sc scuff-neq} for Region-and-Surface Geometries}

\begin{itemize}
 \item Surface 1: vacuum-metal interface
 \item Surface 2: metal-dielectric interface
 \item Surface 3: vacuum-dielectric interface
\end{itemize}

\noindent Structure of surface-current vector:
%====================================================================%
$$ \vb c=
   \left(\begin{array}{c} \vb c_1 \\ \vb c_2 \\ \vb c_3 \end{array}\right),
$$
%====================================================================%
Structure of BEM matrix:
$$ \vb M
    =
   \left(\begin{array}{ccc}
     \vb T_{1}\sups{vacuum} + \vb T_{1}\sups{metal}
   & \vb U_{12}\sups{metal}
   & \vb U_{13}\sups{vacuum}
\\[8pt]
     \vb U_{21}\sups{metal}
   & \vb T_{2}\sups{metal} + \vb T_{2}\sups{dielectric}
   & \vb U_{23}\sups{dielectric}
\\[8pt]
     \vb U_{31}\sups{vac}
   & \vb U_{31}\sups{dielectric}
   & \vb T_{3}\sups{vacuum} + \vb T_{3}\sups{dielectric}
   \end{array}\right)
$$
%====================================================================%
Rytov matrix for metal: 
%====================================================================%
$$ \vb R\sups{metal}
    = \vb W\cdot
   \left[
   \text{sym}
   \left(\begin{array}{ccc}
     \vb T_{1}\sups{metal}
   & 0
   & 0
\\[8pt]
     0
   & \vb T_{2}\sups{metal} 
   & 0
\\[8pt]
     0 
   & 0
   & 0
   \end{array}\right)
   \right]
   \vb W^\dagger
$$
%====================================================================%
Rytov matrix for dielectric: 
%====================================================================%
$$ \vb R\sups{dielectric}
    = \vb W\cdot
   \left[
   \text{sym}
   \left(\begin{array}{ccc}
     0
   & 0
   & 0
\\[8pt]
     0
   & \vb T_{2}\sups{dielectric} 
   & 0
\\[8pt]
     0 
   & 0
   & \vb T_{3}\sups{dielectric} 
   \end{array}\right)
   \right]
   \vb W^\dagger
$$
%====================================================================%
Structure of $\vb Q$ matrices for PFT transfer between the 
composite particle and the exterior (vacuum) region, as
computed using the EPPFT / OPFT formalisms or the DSIPFT 
formalism:
%====================================================================%
$$ \vb Q\supt{EP/O}
    =
   \left(\begin{array}{ccc}
   \vb Q\supt{EP/O}_{1}
   & 0
   & 0
\\[8pt]
     0
   & 0
   & 0
\\[8pt]
     0 
   & 0
   & \vb Q\supt{EP/O}_{3}
   \end{array}\right), 
%--------------------------------------------------------------------%
\qquad
%--------------------------------------------------------------------%
   \vb Q\supt{DSI}
    =
   \left(\begin{array}{ccc}
   \vb Q\supt{DSI}_{11} 
   \vphantom{\vb Q\supt{EP/O}_1}
   \,\,\,\,
   & 0
   & \vb Q\supt{DSI}_{13}
\\[8pt]
     0
   & 0
   & 0
\\[8pt]
   \vb Q\supt{DSI}_{31} \vphantom{\vb Q\supt{EP/O}_1}
   \,\,\,\,
   & 0
   & \vb Q\supt{DSI}_{33}
   \end{array}\right)
$$
%====================================================================%

%=================================================
%=================================================
%=================================================
\newpage
\appendix
\section{Derivation of surface-current bilinears}

In Section \ref{PQsFromSCBsSection} we noted that
the fluxes of power, force, and torque (PFT) at
individual points in space, as well as the 
total PFT absorbed by or exerted on full bodies,
may be expressed as vector-matrix-vector product
formulas of the form 
%====================================================================%
$$ Q = \vb c^\dagger \vb Q \vb c$$
%====================================================================%
where $Q$ is the quantity of interest (a PFT flux or a total PFT), 
$\vb c$ is the vector of surface-current coefficients, 
and $\vb Q$ is a matrix that depends on the quantity we are
computing and the method we use to compute it. In this Appendix  
we discuss the specific forms of the $\vb Q$ matrix appropriate
for various quantities.

\subsection*{Fields from surface currents}

Recall that in the surface-integral-equation (SIE) approach to
classical electromagnetism problems, we solve for tangential
\textit{surface currents} (both electric currents $\vb K$ 
and magnetic currents $\vb N$) flowing on the surfaces of 
homogeneous material bodies. In numerical solvers, we 
approximate these as finite expansions in a discrete set
of $N\subt{B}$ basis functions; using a convenient 6-vector notation 
in which $\bmc C\equiv {\vb K \choose \vb N}$, we put
%--------------------------------------------------------------------%
$$ \bmc C(\vb x)=\sum_{\alpha=1}^{N\subt{B}} 
   c_\alpha \bmc B_\alpha(\vb x) 
$$ 
%--------------------------------------------------------------------%
where $\{\bmc B_\alpha\}$ is a set of 6-vector basis 
functions\footnote{In {\sc scuff-neq} these take the form
$\bmc B_\alpha=$ 
$\vb b_\alpha \choose 0$ 
or 
$0 \choose \vb b_\alpha$
where $\vb b_\alpha$ is a three-vector RWG basis function.
However, the FSC formalism is not specific to this choice.}
and $\{c_\alpha\}$ are scalar expansion coefficients.
(We work at a fixed frequency $\omega$ and assume all fields
and currents vary in time like $e^{-i\omega t}$.)

The electric and magnetic fields produced by these currents
are linear functions of the $\{c_\alpha\}$ coefficients.
In 6-vector notation with $\bmc F\equiv {\vb E \choose \vb H}$, we have
%--------------------------------------------------------------------%
\numeq{FFromC}
{ \bmc F(\vb x)=
   \sum_{\alpha} c_\alpha \bmc F_\alpha(\vb x)
}
%--------------------------------------------------------------------%
where $\bmc F_\alpha={\vb E_\alpha \choose \vb H_\alpha}$ 
is the six-vector of fields produced by basis function $\bmc B_\alpha$ 
populated with unit strength. These may be calculated numerically
as convolutions over basis functions,
%--------------------------------------------------------------------%
$$ \bmc F_\alpha(\vb x)
   =\int_{\sup \bmc B_\alpha} \bmc{G}(\vb x, \vb x^\prime)
    \bmc B_\alpha(\vb x^\prime) \, d\vb x^\prime
$$
%--------------------------------------------------------------------%
where $\bmc{G}$ is an appropriate $6\times 6$ dyadic Green's
function.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Energy and momentum flux from field bilinears}

The Poynting flux and Maxwell stress tensor are quadratic functions
of the field components and may be conveniently written in the form
of 6-dimensional vector-matrix-vector products. 
In particular, the power flux in the direction of a unit vector 
$\vbhat{n}$ is
%====================================================================%
\begin{align}
 \vb P(\vb x) \cdot \vbhat{n}
   &=\frac{1}{2}\text{ Re }\varepsilon_{ijk}\vbhat{n}_i E^*_j(\vb x) H_k(\vb x)
\nn
   &=\frac{1}{4}\bmc{F}^\dagger(\vb x) \, \bmc{N}\supt{P}(\vbhat{n}) \, \bmc{F}(\vb x)
\label{PVMVP}
\end{align}
%====================================================================%
with
%====================================================================%
$$
   \bmc N\supt{P}=
   \left(\begin{array}{cc}
   0       & \vb N\supt{P}   \\ [3pt]
  -\vb N\supt{P} & 0
   \end{array}\right), 
\qquad 
   \vb N\supt{P}
   =
   \left(\begin{array}{ccc}
   0          &  \hat{n}_z & -\hat{n_y} \\
  -\hat{n}_z  &  0         & +\hat{n_x} \\
   \hat{n}_y  & -\hat{n}_x & 0
   \end{array}\right).
$$
%====================================================================%
Similarly, the flux of $i$-directed linear momentum is
%--------------------------------------------------------------------%
\begin{align}
 \vb T_{i}(\vb x) \cdot \vbhat{n} 
&=\frac{1}{2}\text{ Re }
  \left[ \epsilon E^*_i(\vb x) E_j(\vb x) 
             +\mu H^*_i(\vb x) H_j(\vb x) 
       -\frac{\delta_{ij}}{2}
         \Big( \epsilon |\vb E|^2
              +\mu      |\vb H|^2
         \Big)
 \right] \hat {n}_j
\nn
&= \frac{1}{4}\bmc{F}^\dagger(\vb x) 
   \, \bmc{N}\IF \, \bmc{F}(\vb x)
\label{IFVMVP}
\end{align}
with
%--------------------------------------------------------------------%
$$
   \bmc N\IF=
   \left(\begin{array}{cc}
   \epsilon \vb N\IF & 0 \\
            0        & \mu \vb N\IF 
   \end{array}\right)
$$
%--------------------------------------------------------------------%
where the $3\times 3$ matrix $N\IF$ has entries
%--------------------------------------------------------------------%
$$ N\IF_{ab} = 
   \delta_{ai} \hat{n}_b + \delta_{bi} \hat{n}_a
  - \hat{n}_i \delta_{ab}.
$$
%====================================================================%
For example, if we are computing the $x$-force ($i=x$)
we have 
%====================================================================%
$$ \vb N^{x\text{\tiny F}}=\left(\begin{array}{ccc}
   \hat{n}_x & \hat n_y   & \hat n_z \\
   \hat{n}_y & -\hat{n}_x & 0 \\
   \hat{n}_z & 0          & -\hat{n}_x
  \end{array}\right).
$$
The flux of $i$-directed \textit{angular} momentum, useful
for computations of torque about an origin $\vb x_0$, is
%====================================================================%
\begin{align}
 \vb t_{i}(\vb x) \cdot \vbhat{n}
&=\frac{1}{2}
  \text{ Re }
  \varepsilon_{ijk}(\vb x-\vb x_0)_j T_{k\ell}(\vb x) \hat{n}_\ell
\\
&= \frac{1}{4}\bmc{F}^\dagger(\vb x) 
   \, \bmc{N}\IT \, \bmc{F}(\vb x)
\label{ITVMVP}
\end{align}
%====================================================================%
with 
%--------------------------------------------------------------------%
$$
   \bmc N\IT=
   \left(\begin{array}{cc}
   \epsilon \vb N\IT & 0 \\
            0        & \mu \vb N\IT 
   \end{array}\right)
$$
%--------------------------------------------------------------------%
where the $3\times 3$ matrix $N\IT$ has entries ($\vb D=\vb x-\vb x_0$)
%--------------------------------------------------------------------%
$$ N\IT_{ab}=
   \varepsilon_{ija}D_j \hat{n}_b
  +\varepsilon_{ijb}D_j \hat{n}_a
  -\delta_{ab} \varepsilon_{ijk} D_j \hat{n}_k.
$$

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Energy and momentum flux from surface-current bilinears}

Equations (\ref{PVMVP}), (\ref{IFVMVP}), and (\ref{ITVMVP}) express
the flux of power or momentum as bilinear products of the field
six-vectors $\bmc F$. Using (\ref{FFromC}), we can turn these into
bilinear products of the surface-current coefficient vectors
$\vb c$. For example, the power flux (\ref{PVMVP}) becomes 
%--------------------------------------------------------------------%
\begin{align}
 \vb P(\vb x) \cdot \vbhat{n}
&=\frac{1}{4}\bmc F^\dagger(\vb x) \bmc N\supt{P}(\vbhat{n}) \bmc F(\vb x)
\nn
&=\frac{1}{4}\sum_{\alpha \beta} 
  c_\alpha^* 
  \Big[ \bmc F^\dagger_\alpha(\vb x)
        \,
        \bmc N\supt{P}(\vbhat{n})
        \,
        \bmc F_\beta(\vb x)
  \Big]
  c_\beta 
\nn
&= \vb c^\dagger \vb M\supt{PFLUX}(\vb x, \vbhat{n}) \vb c 
\label{PFluxVMVP}
\end{align}
%--------------------------------------------------------------------%
where $\vb M\supt{PFLUX}(\vb x,\vbhat{n})$ is a matrix 
appropriate for $\vbhat{n}$-directed power flux in at $\vb x$.
The fluxes of $i$-directed linear and angular momentum read
similarly
%--------------------------------------------------------------------%
\begin{align}
\vb T_i(\vb x) \cdot \vbhat{n}
&= \vb c^\dagger \vb M\IFFlux(\vb x, \vbhat{n}) \vb c 
\label{IFFluxVMVP}
\\
\vb t_i(\vb x) \cdot \vbhat{n}
&= \vb c^\dagger \vb M\ITFlux(\vb x, \vbhat{n}) \vb c 
\label{ITFluxVMVP}
\end{align}
%--------------------------------------------------------------------%
The $\vb M$ matrices in (\ref{PFluxVMVP}), (\ref{IFFluxVMVP}), and 
(\ref{ITFluxVMVP}) are $N\subt{B}\times N\subt{B}$ matrices
whose entries are themselves 6-dimensional matrix-vector products:
\begin{align*}
M_{\alpha\beta}\supt{PFLUX}(\vb x, \vbhat{n}) 
 &= \frac{1}{4} 
    \bmc F^\dagger_\alpha(\vb x) 
    \bmc N\supt{P}(\vbhat{n})
    \bmc F_\beta(\vb x) 
\\
M_{\alpha\beta}\IFFlux(\vb x, \vbhat{n})
 &= \frac{1}{4} 
    \bmc F^\dagger_\alpha(\vb x) 
    \bmc N\supt{iF}(\vbhat{n})
    \bmc F_\beta(\vb x) 
\\
M_{\alpha\beta}\ITFlux(\vb x, \vbhat{n})
 &= \frac{1}{4} 
    \bmc F^\dagger_\alpha(\vb x) 
    \bmc N\supt{iT}(\vbhat{n})
    \bmc F_\beta(\vb x).
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Power, force, and torque from surface-current bilinears}

The main quantities of interest in {\sc scuff-neq} are the
power, force, or torque (PFT) on individual bodies in a geometry.
There are actually three separate ways to derive surface-current 
bilinear expressions for these quantities, which we here consider 
in turn.

\subsubsection*{Dense surface-integral PFT bilinears}

The simplest way to obtain surface-current bilinears for the
total PFT on one or more bodies is simply to integrate the 
spatially-resolved fluxes of the previous section over a closed
bounding surface $\mc S$ containing the bodies.
Indeed, noting that the $\vb x$ and $\vbhat{n}$ dependence of
the flux expressions (\ref{PFluxVMVP}), (\ref{IFFluxVMVP}),
and (\ref{ITFluxVMVP}) is entirely contained in the $\vb M$
matrices, it is easy to integrate those expressions over
$\mc S$, then pull the surface-current vectors $\vb c$
outside the integral to identify what we shall call
the \textit{dense surface-integral PFT} (DSIPFT) matrices. 

For example, the total power absorbed by material bodies
contained within a closed surface $\mc S$
is given by integrating the LHS of (\ref{PFluxVMVP})
over $\mc S$:
%====================================================================%
\begin{align}
  P_{\mc S}\sups{abs}&=\int_{\mc S} \vb P(\vb x) \cdot \vbhat{n} \, d\vb x
\intertext{with $\vbhat{n}$ taken to be the inward-pointing surface
           normal. Insert the RHS of (\ref{PFluxVMVP}) and pull 
           $\vb c^\dagger, \vb c$ outside the integral:}
             &=\vb c^\dagger \vb M\PS \vb c
\label{PTotVMVP}
\end{align}
where the elements of 
$\vb M\PS$
involve integrals over $\mc S$:
%====================================================================%
\numeq{MPSEntries}
{ M_{\alpha\beta}\PS
  = \frac{1}{4} \int_{\mc S} 
    \bmc F^\dagger_\alpha(\vb x) 
    \bmc N\supt{P}(\vbhat{n})
    \bmc F_\beta(\vb x) 
     \, d\vb x.
}
%====================================================================%
Similarly, the time-average $i$-directed force and torque on 
material bodies contained in $\mc S$ are
%====================================================================%
\begin{align}
 F_{i\mc S} &=\vb c^\dagger \vb M\IFS \vb c
\label{FTotVMVP}
\\
 \mc T_{i\mc S} &=\vb c^\dagger \vb M\ITS \vb c
\label{TTotVMVP}
\end{align}
%====================================================================%
where the entries of $\vb M\IFS$ and $\vb M\ITS$ are similar
to (\ref{MPSEntries}) with $\bmc N\supt{P} \to \bmc N\IF, \bmc N\IT.$

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection*{Sparse surface-integral PFT bilinears}

For some quantities of interest it is possible to write alternative
surface-current bilinears that compute the same quantities as 
(\ref{PTotVMVP}), (\ref{FTotVMVP}), and (\ref{TTotVMVP})
but which involve \textit{sparse} matrices instead of dense
matrices~\cite{Reid2013a}. In particular, the (classical, deterministic) 
power, force, or torque on a body may be written as a bilinear 
function of the surface currents on that body alone in the form
$$
 P = \frac{1}{4}\vb c \vb O\supt{P} \vb c, 
 \qquad
 F_i = \frac{1}{4}\vb c \vb O\IF \vb c
 \qquad
 \mc T_i = \frac{1}{4}\vb c \vb O\IT \vb c
$$
where the $\vb O$ matrices are sparse ``overlap'' matrices
with nonzero entries only for pairs of basis functions
with overlapping support.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection*{Volume-integral PFT bilinears}

\begin{align*}
P&=\text{Re }
  \int_{\mc V} \bmc F^*(\vb x) \cdot \bmc J(\vb x) \, d\vb x
\\
&=
  \int_{\mc V} \bmc F^*(\vb x) \vbchi(\vb x) \bmc F(\vb x)\, d\vb x
\\
&=\sum_{\alpha\beta} c_\alpha^*
  \underbrace{
  \Big[ \int_{\mc V} \bmc G_\alpha^*(\vb x) \vbchi(\vb x)
                     \bmc G_\beta(\vb x) d\vb x
  \Big] c_\beta
             }_{\text{sym } \vb G}
\\
&= \vb c^\dagger \Big[ {\text{sym }\vb G} \Big] \vb c
\intertext{Similarly,}
F_i&=\frac{1}{\omega} \text{Im }
  \int_{\mc V} \bmc F_i^*(\vb x) \cdot \bmc J(\vb x) \, d\vb x
\\
&= \vb c^\dagger 
   \Big[ \frac{1}{\omega}{\text{sym }\partial_i \vb G} \Big] 
   \vb c
\\
\intertext{Similarly,}
\tau_i &= \frac{1}{\omega} \text{Im }
  \int_{\mc V} \bmc F_\theta^*(\vb x) \cdot \bmc J(\vb x) \, d\vb x
\\
&= \vb c^\dagger 
   \Big[ \frac{1}{\omega}{\text{sym }\partial_\theta \vb G} \Big] 
   \vb c
\end{align*}

====================================================================%
%====================================================================%
%===================================================================%
\newpage
\appendix
\section{Computation of DSIPFT PFT matrices}

In Section \ref{PQsFromSCBsSection} we sketched expressions for
the ``dense surface-integral PFT'' (DSIPFT)
matrices $\{\vb M\PS, \vb M\IFS, \vb M\ITS\}$ which, when sandwiched
between surface-current vectors $\vb c$, yield the total
\{power, force, torque\} on objects contained within a bounding
surface $\mc S$. In this appendix we discuss the computation of 
these matrices.

\subsection{Numerical cubature}

To estimate the elements of e.g. the matrix $\vb M\PS$, we
use a cubature rule:
%====================================================================%
\begin{align}
  M_{\alpha\beta}\PS
 &= \frac{1}{4} \int_{\mc S} 
    \bmc F^\dagger_\alpha(\vb x) 
    \,
    \bmc N\supt{P}(\vbhat{n})
    \,
    \bmc F_\beta(\vb x) 
     \, d\vb x
\nn
 &\approx \frac{1}{4} \sum_{n=1}^{N\subt{C}} w_n 
    \bmc F^\dagger_\alpha(\vb x_n) 
    \,
    \bmc N\supt{P}(\vbhat{n}_n)
    \,
    \bmc F_\beta(\vb x_n) 
\label{MPSCubature}
\end{align}
%====================================================================%
where $\{w_n, \vb x_n\}$ is an $N\subt{C}$-point cubature rule 
for the surface $\mc S$ and $\vbhat{n}_n$ is the outward-pointing
surface normal to $\mc S$ at $\vb x_n.$
 
\subsection{Precomputation of field six-vectors}

%====================================================================%
%====================================================================%
%====================================================================%
\section{Computation of VIPFT force and torque matrices}

The VIPFT matrices for the force and torque require matrix
elements of Helmholtz kernel derivatives: 
%====================================================================%
\begin{subequations}
\begin{align}
 \Big[\partial_i \vb G\Big]\supt{PQ}_{\alpha \beta}
&= \int\, d\vb x \, \int \, d\vb x^\prime \,
   b_{\alpha j}(\vb x) \partial_i \Gamma_{jk}\supt{PQ}(\vb x-\vb x^\prime)
   b_{\beta k}(\vb x^\prime)
\\[5pt]
 \Big[\partial_\theta \vb G\Big]\supt{PQ}_{\alpha \beta}
&= \int\, d\vb x \, \int \, d\vb x^\prime \,
   b_{\alpha j}(\vb x) 
   \partial_\theta \Gamma_{jk}\supt{PQ}(\vb x-\vb x^\prime)
   b_{\beta k}(\vb x^\prime)
\end{align}
\label{dGIntegrals}
\end{subequations}
%====================================================================%
where $\partial_i$ denotes the derivative of $\Gamma$ 
with respect to a infinitesimal displacement of $\vb x$
in the $i$th caresian direction, 
while $\partial_\theta$ denotes the derivative with respect to an a
infinitesimal rotation of $\vb x$ about some origin $\vb x_0$ and 
rotation axis $\vbhat{a}$ (my notation hides the dependence on 
$\vb x_0$ and $\vbhat{a}$).

Integrals of the form (\ref{dGIntegrals}) are required for 
FSC calculations of equilibrium Casimir forces and torques,
and thus their computation is implemented in my {\sc scuff-cas3d} code.
However, in the equilibrium case we only ever need to compute
matrix elements of the form (\ref{dGIntegrals}) between basis
functions that live on different objects; hence the integrals
are always nonsingular and may be evaluated by simple 
numerical quadrature, as is done in {\sc scuff-cas3d}.

A major complication in the non-equilibrium case, which is
not present in the equilibrium case, is that here we must
also compute integrals (\ref{dGIntegrals}) for basis
functions living on the \textit{same} object; these are needed 
to evaluate the self-term contributions to the non-equilibrium
force and torque. This means we must handle the case in
which the supports of the basis functions overlap, and the
integrals are thus singular. In {\sc scuff-neq} we do this
using the generalized Taylor-Duffy method reported 
in~\citeasnoun{Reid2013C}. In this section we discuss the 
forms of the $P$, $K$, and $\mc K$ functions relevant for
this computation. (The $\mc P$ functions, which are generated
by {\sc mathematica} using techniques discussed in~\citeasnoun{Reid2013C},
are much too complicated to reproduce here.)

\paragraph{Representation of integrals in generalized Taylor-Duffy form}

As usual, the kernels in (\ref{dGIntegrals}) are related to the 
dyadic Helmholtz Green's functions $\vb G, \vb C$ according to
%====================================================================%
$$ 
 \Gamma\supt{EE}_{ij}(\vb r)
= ikZ_0 Z^r G_{ij}(\vb r),
\qquad
 \Gamma\supt{EM}_{ij}(\vb r)
= ik C_{ij}(\vb r), 
$$
$$
 \Gamma\supt{ME}_{ij}(\vb r)
= -ik C_{ij}(\vb r), 
\qquad 
 \Gamma\supt{MM}_{ij}(\vb r)
= \frac{ik}{Z_0 Z^r} G_{ij}(\vb r)
$$
with 
%====================================================================%
$$
 G_{jk}(\vb r) 
= \left[ f_1(ikr)\delta_{ij} + f_2(ikr)\frac{r_i r_j}{r^2}\right] 
   \frac{e^{ikr}}{4\pi (ik)^2 r^3} 
, \qquad 
 C_{jk}(\vb r) 
= \varepsilon_{jk\ell } r_\ell f_3(ikr)
   \frac{e^{ikr}}{4\pi ik r^3},
$$
$$
 f_1(x) = 1 -x+ x^2, \qquad 
 f_2(x) = -3 + 3x - x^2, \qquad 
 f_3(x) = x - 1.
$$
%====================================================================%
In general, the matrix elements of a dyadic kernel $\bmc O$ between
RWG functions involve contributions from four panel-panel pairs:
%====================================================================%
\begin{align*}
 \Big\langle 
   \vb b_\alpha 
 \Big| 
   \bmc O
 \Big| 
   \vb b_\beta 
 \Big\rangle
&= \ell_\alpha \ell_\beta \sum \pm 
  \underbrace{
   \frac{1}{4A_\alpha^\pm A_\beta^\pm}
   \int_{\mc P_\alpha^\pm } \, d\vb x        \,
   \int_{\mc P_\beta^\pm} \, d\vb x^\prime \,
   (\vb x-\vb Q)_j (\vb x^\prime-\vb Q^\prime)_k
   \mc O_{jk}(\vb r)
             }_{\mc I(\mc O; \mc P_\alpha, \mc P_\beta)}
\end{align*}
%====================================================================%
The derivatives of the dyadic GFs are
%====================================================================%
\begin{align*}
 \partial_i G_{jk}(\vb r)
&=
  \bigg\{ f_2(ikr)\Big[ r_i\delta_{jk} + r_j\delta_{ik} + r_k\delta_{ij} \Big]
         +(ikr)^2 f_3(ikr) r_i \delta_{jk}
\\
&\hspace{0.75in}
         + f_4(ikr)\frac{r_i r_j r_k}{r^2}
  \bigg\} \frac{e^{ikr}}{4\pi (ik)^2 r^5}
\intertext{[where $ f_4(x)=15-15x+6x^2 - x^3$]}
 \partial_i C_{jk}(\vb r)
&=\varepsilon_{jk\ell}
  \bigg\{  f_3(ikr) \delta_{i\ell} 
          -f_2(ikr) \frac{r_i r_\ell}{r^2} 
  \bigg\} \frac{e^{ikr}}{4\pi (ik) r^3}
\end{align*}
%====================================================================%
With these expressions we may write the panel-panel
integrals in a form suitable for treatment by the generalized 
Taylor-Duffy method:
%====================================================================%
\begin{align*}
 \mathcal{I}(\partial_i \vb G;  \mc P_\alpha, \mc P_\beta)
&=\frac{1}{(ik)^2}
\iint \Big[  P\supt{G1}(\vb x, \vb x^\prime) K\supt{G1}(r)
             + P\supt{G2}(\vb x, \vb x^\prime) K\supt{G2}(r)
             + P\supt{G3}(\vb x, \vb x^\prime) K\supt{G3}(r)
        \Big]\,d\vb x\,d\vb x^\prime
\\
 \mathcal{I}(\partial_i \vb C; \mc P_\alpha, \mc P_\beta)
&=\frac{1}{ik}
  \iint \Big[  P\supt{C1}(\vb x, \vb x^\prime) K\supt{C1}(r)
              +P\supt{C2}(\vb x, \vb x^\prime) K\supt{C2}(r)
        \Big]\,d\vb x \, d\vb x^\prime
\end{align*}
%====================================================================%
where the $P$s and $K$s are
%====================================================================%
\begin{align*}
%--------------------------------------------------------------------%
P\supt{G1} 
 &= (\vb x - \vb x^\prime)_i 
    \Big[ (\vb x-\vb Q) \cdot (\vb x^\prime-\vb Q^\prime)\Big] 
\\
 &\quad + (\vb x-\vb Q)_i 
          \Big[ (\vb x - \vb x^\prime) \cdot (\vb x^\prime-\vb Q^\prime) \Big]
        + (\vb x^\prime-\vb Q^\prime)_i 
          \Big[ (\vb x - \vb x^\prime) \cdot (\vb x-\vb Q) \Big]
\\
%--------------------------------------------------------------------%
K\supt{G1}
&= f_2(ikr)\frac{e^{ikr}}{4\pi r^5}
\\[5pt]
%--------------------------------------------------------------------%
P\supt{G2}
&=(\vb x - \vb x^\prime)_i 
   \Big[(\vb x-\vb Q) \cdot (\vb x^\prime-\vb Q^\prime)\Big]
\\
%--------------------------------------------------------------------%
K\supt{G2}
&= (ik)^2 f_3(ikr)\frac{e^{ikr}}{4\pi r^3}
\\[5pt]
%--------------------------------------------------------------------%
P\supt{G3} 
&=(\vb x - \vb x^\prime)_i 
   \Big[ (\vb x-\vb x^\prime) \cdot (\vb x-\vb Q)  \Big]
   \Big[ (\vb x-\vb x^\prime) \cdot (\vb x^\prime-\vb Q^\prime)  \Big]
\\
%--------------------------------------------------------------------%
K\supt{G3}
&= f_4(ikr)\frac{e^{ikr}}{4\pi r^7}
\\[5pt]
%--------------------------------------------------------------------%
P\supt{C1}
&=\Big[(\vb x-\vb Q) \times (\vb x^\prime - \vb Q^\prime)\Big]_i
\\
%--------------------------------------------------------------------%
K\supt{C1}
&= f_3(ikr)\frac{e^{ikr}}{4\pi r^3}
\\[5pt]
%--------------------------------------------------------------------%
P\supt{C2}
 &= -(\vb x - \vb x^\prime)_i
     \bigg\{ (\vb x - \vb x^\prime) \cdot 
     \Big[ (\vb x-\vb Q)\times (\vb x^\prime-\vb Q^\prime) \Big]\bigg\}
\\
%--------------------------------------------------------------------%
K\supt{C2}
&= 
f_2(ikr) \frac{e^{ikr}}{4\pi r^5}
\end{align*}
%====================================================================%
The ``first integrals'' of the $K$ kernels here may be computed
as follows:
\begin{align*}
 \text{if  } K(r) &= (ikr)^p \frac{e^{ikr}}{4\pi r^q} 
\\
 \text{then  } \mc K_n(r) &\equiv\int_0^n w^n K(wX) \, dw
\\
 &=\frac{(ik)^p e^{ikX}}{4\pi(n+p+1-q)}\, X^{n+p-q} \,
   \texttt{ExpRel}\Big[n+p+1-q, -ikX\Big].
\end{align*}



%====================================================================%
%====================================================================%
%====================================================================%
\newpage
\bibliographystyle{ieeetr}
\bibliography{scuff-neq}

\end{document}
