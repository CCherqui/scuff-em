\documentclass[letterpaper]{article}

\input{../scufftex}

\graphicspath{{figures/}}
\newcommand{\GBar}{\overline{G}}
\newcommand{\KB}{\vb K\supt{B}}

%------------------------------------------------------------
%------------------------------------------------------------
%- Special commands for this document -----------------------
%------------------------------------------------------------
%------------------------------------------------------------

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Periodic Boundary Conditions}

\subsection{Continuous BEM formulations with PBCs}

Consider the electric field integral equation for
the unknown surface-current density $\vb K(\vb x)$ on 
an infinite surface $\mc S_\infty$:
%====================================================================%
\numeq{InfiniteEFIE}
{
  \vb E\sups{scat}(\vb x)\equiv 
  \int_{\mc S_\infty} 
   \BG_{\parallel}\supt{EE}(\vb x, \vb x^\prime) 
   \cdot 
   \vb K(\vb x^\prime)d\vb x^\prime
  =-\vb E_{\parallel}\sups{inc}(\vb x)
}
%====================================================================%
If we now suppose that 
%====================================================================%
\begin{itemize}
 \item the surface $\mc S_\infty$ consists of an infinite lattice
       of copies of a unit-cell surface $\mc S_0$ translated through
       two-dimensional lattice vectors of the form 
       \numeq{LatticeVectors}{\vb L=n_1 \vb L_1 + n_2\vb L_2}
       and
 \item the incident field respects this periodicity in the sense that 
       $$ \vb E\sups{inc}(\vb x+\vb L)
          = e^{i\KB \cdot \vb L} \vb E\sups{inc}(\vb x)
       $$
       for some Bloch vector $\KB$
\end{itemize}
%====================================================================%
then we can assume the surface current $\vb K(\vb x)$ will satisfy
the same Bloch periodicity condition, i.e.
%====================================================================%
$$ \vb K(\vb x+\vb L)
   = e^{i\KB \cdot \vb L} \vb K(\vb x)
$$
%====================================================================%
whereupon we can rewrite the LHS of (\ref{InfiniteEFIE}) in the form
%====================================================================%
\begin{align}
   \vb E\sups{scat}(\vb x)
&= \sum_{\vb L}
   \int_{\mc S_0}
   \BG_{\parallel}\supt{EE}(\vb x, \vb x^\prime+\vb L)
   \cdot 
   \vb K(\vb x^\prime + \vb L )d\vb x^\prime
\\
&= 
\end{align}
%====================================================================%

\subsection{Discretized PBC-BEM formulation using RWG functions}

\subsubsection{PBC geometries in {\sc scuff-em}}

\lss supports Bloch-periodic boundary conditions for
periodically repeated geometries. In this case,

\begin{itemize}
 \item The \texttt{.scuffgeo} file will contain
       a \texttt{LATTICE...ENDLATTICE} section defining 
       between one and three lattice basis vectors 
       $\vb L_1, \vb L_2, \vb L_3.$ (In the present 
       discussion we will consider the common case
       of two-dimensional periodicity, so we have two
       lattice basis vectors $\vb L_1, \vb L_2$.) 
       We assume that $\vb L_1, \vb L_2$ have no 
       component in the $z$ direction.
 \item The only portion of the geometry that is
       meshed is that contained with the ``unit cell.''
 \item We will refer to the lattice cell obtained by 
       displacing the unit cell through displacement 
       vector $\vb L=n_1 \vb L_1 + n_y \vb L_2$ as 
       ``lattice cell $(n_1, n_2)$'' or sometimes
       ``lattice cell $\vb L$''.
 \item All currents and fields in lattice cell $(n_1,n_2)$
       are understood to be equal to the corresponding
       currents and fields in lattice cell $(0,0)$ times
       a Bloch phase factor $e^{i\vb p\cdot \vb L}$ where
       $\vb p$ is the Bloch wavevector.
\end{itemize}

\subsubsection{PBC geometries in {\sc scuff-em}}

\subsection{Straddlers}

Consider the

\subsubsection{PBC geometries in {\sc scuff-em}}
\subsection{Evaluation of surface currents within the unit cell}

When evaluating the $\vb K$ and $\vb N$ surface-current 
distributions at panels that border the upper or right edges 
of the unit-cell mesh, we have to be careful to account for the 
contribution of straddlers. 

For example, consider evaluating the electric surface current at 
points $\vb x$ inside panel $\mc P_9$ in Figure (??) %\ref{Mesh3x3}.
There are three RWG basis functions that contribute to the current
at this point: $\vb b_7$, $\vb b_9,$ and the periodic image of 
$\vb b_2$:

\subsection{Periodic DGFs}

To avoid confusion with the free-space photon wavenumber, 
I use the symbol $\vb p$ to denote a two-dimensional 
Bloch wavevector.

I use an overbar notation to denote the 
\textit{periodic Green's function}, which contains contributions
from all lattice cells appropriately weighted by Bloch phases.
$$
  \GBar(\vb p; k; \vb r, \vb r^\prime)
= \sum_{\vb L} e^{i \vb p \cdot \vb L} G(k; \vb r, \vb r^\prime+\vb L)
\qquad 
 \bigg( G(k; \vb r, \vb r^\prime) 
 = \frac{e^{ik|\vb r-\vb r^\prime|}}{4\pi|\vb r-\vb r^\prime|}
 \bigg)
$$

I will also need to define a version of this function that 
excludes the contributions of the innermost 9 lattice cells.
I will call this version 
$\GBar_{\texttt{AB9}}$
%$\GBar_{\text{\scriptsize{AB9}}}$, 
where the subscript stands for 
stands for ``all but 9.''

\subsection{Assembling the BEM matrix}

\begin{align*}
M_{\alpha\beta}
\end{align*}

\subsubsection{Relations between BEM matrix elements}

Let $\vb L$ be a lattice 

\end{document}
