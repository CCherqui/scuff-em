%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Equivalence-principle PFT (EPPFT)}

In the EPPFT approach, we compute the power, force and torque
on a body $\mc B$ by considering the work done on, and the force and
torque exerted on, the equivalent surface currents $\vb K, \vb N$
flowing on the body surface $\partial \mc B$.

The power may be computed as the Joule heating of the
$\vb K$ and $\vb N$ currents by the $\vb E$ and $\vb H$ fields:
%====================================================================%
\begin{subequations}
\begin{equation}
 P\sups{abs} 
     = \frac{1}{2}\text{ Re }
      \int_{\partial \mc B} \Big[ \vb K^*(\vb x) \cdot \vb E(\vb x)
                                 +\vb N^*(\vb x) \cdot \vb H(\vb x)
                            \Big] \, dA
\end{equation}
%====================================================================%
The force may be computed by summing the Lorentz forces on the charges 
and currents in each infinitesimal surface patch $dA$:
%====================================================================%
\begin{equation}
 F_i  = \frac{1}{2}\text{ Re }
      \int_{\partial \mc B} 
 \bigg\{   \sigma\subt{E}^*\, \vb E_i(\vb x)
         +Z_0\big(\vb K^* \times \vb H\big)_{i}
         +\sigma\subt{M}^*\, \vb H_i(\vb x)
         -\frac{1}{Z_0}\big(\vb N^* \times \vb E\big)_{i}
 \bigg\}
\end{equation}
\label{EPPFTContinuous}
\end{subequations}
where the electric and magnetic surface charge densities are
%====================================================================%
$$ \sigma\subt{E} \equiv \frac{\nabla \cdot \vb K}{i\omega},
   \qquad
   \sigma\subt{M} \equiv \frac{\nabla \cdot \vb N}{i\omega}.
$$
%====================================================================%

\subsection*{Interior vs. exterior fields}
    
Equations (\ref{EPPFTContinuous}) involve the fields at the surface
of the body. In an SIE scattering problem involving incident-field 
sources external to the body, we have a choice of two equivalent ways 
to compute these fields:
%====================================================================%
\begin{itemize}
\item We can use the formula for the fields outside the body, which
involves contributions from surface currents on all bodies
$\{\mc B^\prime\}$ in the scattering problem, plus a contribution 
from the incident field:
%====================================================================%
\numeq{FOutExpansion} 
 {  \bmc F\sups{out} 
    =  2\Big[\sum_{\mc B^\prime} \bmc G\sups{out} \star \bmc C_{\mc B^\prime}
             +\bmc F\sups{inc}\Big]
 }
%====================================================================%
Here $\bmc G\sups{out}$ is the Green's function for the medium outside
body $\mc B$, and the factor of $2$ arises from the fact, well known 
in the SIE literature~\cite{Chen1989},
that the convolution yields precisely one-half the full fields when
the evaluation point lies on the surface.
%====================================================================%
\item Alternatively, we can use the formula for the fields
      \textit{inside} the body, which references only the surface
      currents on $\mc B$ and involves no surface-current contribution:
%====================================================================%
\numeq{FInExpansion} 
 {  \bmc F\sups{in}
     = -2\,\bmc G\sups{in} \star \bmc C_{\mc B}.
 }
%====================================================================%
\end{itemize}
%====================================================================%
Evidently it is easier to use the interior expansion (\ref{FInExpansion}),
for which we need only the surface currents on $\mc B$. However,
there is a subtlety here: The fields that act on the surface currents 
in equations (\ref{EPPFTContinuous}) are the fields at the surface as 
approached from \textit{outside} the body, but formula (\ref{FInExpansion}) 
computes the fields at the surface as approached from the \textit{inside}.
This distinction makes no difference for the tangential field
components, which are continuous across the surface, but
does affect the normal components. Equation (\ref{EPPFTContinuous}a) 
for the absorbed power, which involves only tangential field
components, is unaffected by this subtlety, but for 
(\ref{EPPFTContinuous}b) there is a correction factor.
To derive this, think of the $\vb E$ and $\vb H$ fields
in (\ref{EPPFTContinuous}b) as the ``outer'' fields 
$\{\vb E\sups{out}, \vb H\sups{out}\}$, and relate these to the 
``inner'' fields
$\{\vb E\sups{in}, \vb H\sups{in}\}$ according to
%====================================================================%
\begin{align}
 \vb E\sups{out} 
&=   \vb E\sups{out}_\parallel + E\sups{out}_{\vbhat n} \vbhat{n}
 = \vb E\sups{in}_\parallel +
   \frac{\epsilon\subs{in}}{\epsilon\subs{out}}
   E\sups{in}_{\vbhat{n}}\vbhat{n}
\nonumber\\[6pt]
%--------------------------------------------------------------------%
&= \vb E\sups{in} +
   \gamma\subt{E} \sigma\subt{E} \vbhat{n},
   \qquad
   \gamma\supt{E} \equiv \frac{1}{\epsilon_0}
            \Big( \frac{1}{\epsilon\supt{in}} -
                  \frac{1}{\epsilon\supt{out}}
            \Big)
\label{EOutEIn}
%--------------------------------------------------------------------%
\intertext{where we used that the normal component of the interior 
           field is $E\sups{in}_{\vbhat n}=
                      \frac{\sigma\subt{E}}{\epsilon_0 \epsilon\supt{in}}$.
           Similarly, for the $\vb H$ field we find}
%--------------------------------------------------------------------%
\vb H\sups{out}
&= \vb H\sups{in} + \gamma\subt{M}\sigma\subt{M} \vbhat{n}, 
\qquad
   \gamma\supt{M} \equiv \frac{1}{\mu_0}
            \Big( \frac{1}{\mu\supt{in}}   -
                  \frac{1}{\mu\supt{out}}
            \Big).
\label{HOutHIn}
\end{align}
%====================================================================%
Using (\ref{EOutEIn}) and (\ref{HOutHIn}) to substitute inner for
outer fields in (\ref{EPPFTContinuous}b) yields
%====================================================================%
\begin{align*}
 F_i &= \frac{1}{2}\text{ Re }
      \int_{\partial \mc B} 
 \bigg\{   \sigma\subt{E}^*\, \vb E\sups{in}_i(\vb x)
         +Z_0\big(\vb K^* \times \vb H\sups{in}\big)_{i}
         +\sigma\subt{M}^*\, \vb H\sups{in}_i(\vb x)
         -\frac{1}{Z_0}\big(\vb N^* \times \vb E\sups{in}\big)_{i}
\\
&\qquad\qquad + 
  \Big( \gamma\subt{E} |\sigma\subt{E}^*| + \gamma\subt{M}|\sigma\subt{M}^*|
  \Big)\vbhat{n}
  +Z_0\gamma\subt{M}\sigma\subt{M}\Big(\vb K^* \times \vbhat{n}\Big)_i
  -\frac{1}{Z_0}
      \gamma\subt{E}\sigma\subt{E}\Big(\vb N^* \times \vbhat{n}\Big)_i
 \bigg\}.
\end{align*}

\subsection*{Implementation in {\sc scuff-em}}

Recall that the $\vb E$ and $\vb H$ fields due to a set of
RWG basis functions $\{\vb b_\alpha(\vb x)\}$ populated
with electric and magnetic surface-current weights 
$\vb k_\alpha, \vb n_\alpha$ are 
%====================================================================%
\begin{align*}
\vb E(\vb x) 
 &= \sum_{\alpha} \Big( ikZ k_\alpha \vb e_\alpha(\vb x)
                        -n_\alpha \vb h_\alpha(\vb x)
                  \Big)
\\
\vb H(\vb x) 
 &= \sum_{\alpha} \Big( k_\alpha \vb h_\alpha(\vb x)
                        +\frac{ik}{Z} n_\alpha \vb e_\alpha(\vb x)
                  \Big)
\end{align*}
%====================================================================%
where $k=\sqrt{\epsilon \mu}\cdot \omega$ is the wavenumber in the relevant
medium, $Z=Z_0Z^r$ with $Z^r=\sqrt{\mu/\epsilon}$ the relative wave impedance,
and $\vb e_\alpha, \vb h_\alpha$ are the ``reduced fields'' of basis
function $\vb b_\alpha:$
%====================================================================%
$$
 \vb e_\alpha(\vb x) = \vb a_\alpha(\vb x) + \frac{1}{k^2}\nabla p_\alpha(\vb x),
 \qquad
 \vb h_\alpha(\vb x) = \nabla \times \vb a_\alpha(\vb x)
$$
with $\vb a$ and $p$ the ``reduced'' vector and scalar potentials
of $\vb b_\alpha,$
%====================================================================%
$$
 \vb a_\alpha(\vb x) 
 = 
 \int G(\vb x-\vb x^\prime) \vb b_\alpha(\vb x^\prime) d\vb x^\prime 
\qquad
 p_\alpha(\vb x) 
 = 2\int G(\vb x-\vb x^\prime) d\vb x^\prime 
$$
%====================================================================%
where the integrals are over the supports of $\vb b_\alpha$
and $G(\vb r)=\frac{e^{ik|\vb r|}}{4\pi|\vb r|}$ is the 
scalar Green's function in the medium.

In terms of the surface-current coefficients, the absorbed power
reads 
%====================================================================%
\begin{align*}
 P\sups{abs} 
&= \frac{1}{2}\text{Re }\sum_{\alpha\beta}
   k^*_\alpha \Big[  ikZ  k_\beta\inp{\vb b_\alpha}{\vb e_\beta}
                         -n_\beta\inp{\vb b_\alpha}{\vb h_\beta}
              \Big]
+
   n^*_\alpha \Big[   k_\beta\inp{\vb b_\alpha}{\vb h_\beta}
                    + \frac{ik}{Z} n_\beta\inp{\vb b_\alpha}{\vb e_\beta}
              \Big]
\\
 &= \text{Re }\sum_{\alpha\beta}
    \left(
     \begin{array}{c}
      k_\alpha \\[5pt]
      n_\alpha
     \end{array}
    \right) ^\dagger
%--------------------------------------------------------------------%
    \left(\begin{array}{cc}
     P\supt{EE}_{\alpha\beta} & 
     P\supt{EM}_{\alpha\beta} \\[5pt]
     P\supt{ME}_{\alpha\beta} &
     P\supt{MM}_{\alpha\beta}
     \end{array}
    \right)
%--------------------------------------------------------------------%
    \left(
     \begin{array}{c}
      k_\alpha \\[5pt]
      n_\alpha
     \end{array}
    \right)
\end{align*}
%====================================================================%
$$\begin{array}{lclclcl}
 \displaystyle{
 P\supt{EE}_{\alpha\beta}
              }
 &=&
 \displaystyle{
 \frac{ikZ}{2} \inp{\vb b_\alpha}{\vb e_\beta}
              }
%--------------------------------------------------------------------%
 &\qquad&
%--------------------------------------------------------------------%
 \displaystyle{
 P\supt{EM}_{\alpha\beta}
              }
 &=&
%--------------------------------------------------------------------%
 \displaystyle{
 -\frac{1}{2}\inp{\vb b_\alpha}{\vb h_\beta}
              }
\\[8pt]
%--------------------------------------------------------------------%
 \displaystyle{
 P\supt{EM}_{\beta\alpha}
              }
 &=&
 \displaystyle{
 +\frac{1}{2}\inp{\vb b_\alpha}{\vb h_\beta}
              }
%--------------------------------------------------------------------%
 &\quad& 
%--------------------------------------------------------------------%
 P\supt{MM}_{\beta\alpha}
 &=&
 \displaystyle{
 +\frac{ik}{2Z}\inp{\vb b_\alpha}{\vb e_\beta}
              }
\end{array}$$
%====================================================================%
In terms of the surface-current coefficients, the $i$-directed force reads 
\begin{align*}
 F_i
= \frac{1}{2}\text{Re }\sum_{\alpha\beta}
 \bigg\{&
   k^*_\alpha\pf{1}{i\omega}^*
    \Big[ ikZ k_\beta \inp{\nabla \cdot \vb b_\alpha}{\vb e_{\beta i}}
             -n_\beta  \inp{\nabla \cdot \vb b_\alpha}{\vb h_{\beta i}}
    \Big]
\\
&+ Z_0 k^*_\alpha
    \Big[ k_\beta \big\langle \vb b_\alpha \times \vb h_\beta\big\rangle_i
         +\frac{ik}{Z} n_\beta \big\langle \vb b_\alpha \times \vb e_\beta\big\rangle_i
    \Big]
\\
&+
   n^*_\alpha\pf{1}{i\omega}^*
    \Big[ k_\beta \inp{\nabla \cdot \vb b_\alpha}{\vb h_{\beta i}}
         +\frac{ik}{Z} +n_\beta \inp{\nabla \cdot \vb b_\alpha}{\vb e_{\beta i}}
    \Big]
\\
&- \frac{1}{Z_0} n^*_\alpha
    \Big[ ikZ k_\beta \big\langle \vb b_\alpha \times \vb e_\beta\big\rangle_i
          -n_\beta \big\langle \vb b_\alpha \times \vb h_\beta\big\rangle_i
    \Big] \bigg\}.
\end{align*}
%====================================================================%
or 
%====================================================================%
$$
 F_i
  = \text{Re }\sum_{\alpha\beta}
    \left(
     \begin{array}{c}
      k_\alpha \\[5pt]
      n_\alpha
     \end{array}
    \right) ^\dagger
%--------------------------------------------------------------------%
    \left(\begin{array}{cc}
     F\supt{EE}_{\alpha\beta} & 
     F\supt{EM}_{\alpha\beta} \\[5pt]
     F\supt{ME}_{\alpha\beta} &
     F\supt{MM}_{\alpha\beta}
     \end{array}
    \right)
%--------------------------------------------------------------------%
    \left(
     \begin{array}{c}
      k_\alpha \\[5pt]
      n_\alpha
     \end{array}
    \right)
$$
%====================================================================%
\begin{align*}
 F\supt{EE}_{\alpha\beta}
 &=
 -\pf{1}{2\omega}
  kZ \inp{\nabla \cdot \vb b_\alpha}{\vb e_{\beta i}}
               +Z_0  \big\langle \vb b_\alpha \times \vb h_\beta\big\rangle_i 
\\
%--------------------------------------------------------------------%
 F\supt{EM}_{\alpha\beta}
 &=
 +\frac{kZ}{2\omega} \inp{\nabla \cdot \vb b_\alpha}{\vb h_{\beta i}}
               +Z_0  \big\langle \vb b_\alpha \times \vb h_\beta\big\rangle_i 
\\
\end{align*}
